var EditorVersion=8;var canv;var context;var contextWidth;var contextHeight;var contextStep;var elContextMenu;var variables;var viewlist;var settings;var scheme;var page;var controlList;var contextmenu_colormode;var UnsavedProject=0;var NewProject=1;var ProjectName;var ProjectVersion=EditorVersion;var touchx;var touchy;var MAX_X=100;var MAX_Y=100;var elContent, elEditorContent, elHeaderUser, elEditorLeftGroups, elEditorRightGroups, elEditorCentercol, elPhone;var elButtonHorizontal, elButtonVertical;var elHeaderHeight=70;var elFooterHeight=50;var elHeaderUserHeight=0;var elContentHeight=0;var elCentercolHeight=0;var elCentercolWidth=0;var timerEditorContentHeight;var historyArray=[];var historyPosition=-1;var historyPositionMax=-1;var intermediateUnsaved=0;function updateEditorPage (always) {if(always==undefined) always=0;/*
if((elContentHeight!=elContent.clientHeight)||(always)) {elContentHeight=elContent.clientHeight;var h=elContentHeight-elHeaderHeight-elFooterHeight-elHeaderUserHeight-3;elEditorContent.style.minHeight=h+'px';elEditorContent.style.paddingTop=(elHeaderHeight+elHeaderUserHeight+elFooterHeight)+'px';elEditorLeftGroups.style.minHeight=(h-30)+'px';elEditorRightGroups.style.minHeight=(h-30)+'px';}
*/
if(!isTablet ()) {elEditorRightGroups.style.minHeight= (document.getElementById('editor_rightcol').clientHeight-30)+'px';elEditorLeftGroups.style.minHeight= (document.getElementById('editor_leftcol').clientHeight-30)+'px';}
else {elEditorRightGroups.style.minHeight="";elEditorLeftGroups.style.minHeight="";}
if((elCentercolHeight!=elEditorCentercol.clientHeight)||(elCentercolWidth!=elEditorCentercol.clientWidth)||(always)) {var or=page.getViewOrientation ();var y0=74;elPhone.src='';if(or==ORIENTATION_HORIZONTAL) {elPhone.src='/img/editor/phone.png';var k=463/292;var kp=1000/556;MAX_X=100;MAX_Y=Math.round(MAX_X/k);}
else {elPhone.src='/img/editor/phonev.png';var k=292/463;var kp=556/1000;MAX_Y=100;MAX_X=Math.round(MAX_Y*k);}
elCentercolHeight=elEditorCentercol.clientHeight;elCentercolWidth=elEditorCentercol.clientWidth;var paddingHeight=Math.round(elCentercolHeight/20);var paddingWidth=Math.round((elCentercolWidth-300)/10);var height, width, heightp, widthp;var x=Math.round(elCentercolWidth/2);var y=(elCentercolHeight-y0)/2+y0;if((elCentercolWidth-paddingWidth*2)/(elCentercolHeight-y0-paddingHeight*2)>kp) {heightp=elCentercolHeight-y0-paddingHeight*2;widthp=Math.round(heightp*kp);}
else {widthp=elCentercolWidth-paddingWidth*2;heightp=Math.round(widthp/kp);}
if(or==ORIENTATION_HORIZONTAL) {height=Math.round(heightp*0.88);width=Math.round(height*k);contextStep=width/100;}
else {width=Math.round(widthp*0.88);height=Math.round(width/k);contextStep=height/100;}
elPhone.style.top=Math.round(y-heightp/2)+'px';elPhone.style.left=Math.round(x-widthp/2)+'px';elPhone.style.width=widthp+'px';elPhone.style.height=heightp+'px';canv.style.top=Math.round(y-height/2)+'px';canv.style.left=Math.round(x-width/2)+'px';canv.style.width=width+'px';canv.style.height=height+'px';canv.width=width;canv.height=height;contextWidth=width;contextHeight=height;context=canv.getContext('2d');Draw ();}}function getElements () {elContent=document.getElementById('content');elEditorContent=document.getElementById('editor_content');elHeaderUser=document.getElementById('header_user');elEditorLeftGroups=document.getElementById('editor_left_groups');elEditorRightGroups=document.getElementById('editor_right_groups');elEditorCentercol=document.getElementById('editor_centercol');elPhone=document.getElementById('editor_phone');elButtonHorizontal=document.getElementById('editor_button_horizontal');elButtonVertical=document.getElementById('editor_button_vertical');if(elHeaderUser) elHeaderUserHeight=elHeaderUser.clientHeight;elContextMenu=document.getElementById("div_contextmenu");}function run () {canv=document.getElementById('editor');if(!(canv&&canv.getContext)) {return;}
context=canv.getContext('2d');getElements ();CanvasRenderingContext2D.prototype.fillRoundedRect=fillRoundedRect;CanvasRenderingContext2D.prototype.fillRoundedRect4=fillRoundedRect4;canv.style.cursor="default";page=new Page ();scheme=new Scheme ();settings=new Settings ();controlList=new ControlList ();viewlist=new ViewList (canv, context, contextWidth, contextHeight);loadConfiguration ();updateEditorPage (1);timerEditorContentHeight=setInterval(updateEditorPage,1000);canv.onmousedown=function (e) {return viewlist.ViewListOnMouseDown (e);}
canv.ontouchstart=function (e) {return viewlist.ViewListOnMouseDown (e);}
canv.onmousemove=function (e) {return viewlist.ViewListOnMouseMove (e);}
canv.ontouchmove=function (e) {return viewlist.ViewListOnMouseMove (e);}
canv.onmouseup=function (e) {return viewlist.ViewListOnMouseUp (e);}
canv.ontouchend=function (e) {return viewlist.ViewListOnMouseUp (e);}
canv.oncontextmenu=function (e) {return viewlist.oncontextmenu (e);}
document.body.onmousemove=OnMouseMoveBody;document.body.ontouchmove=OnMouseMoveBody;document.body.onmouseup=OnMouseUpBody;document.body.ontouchend=OnMouseUpBody;document.body.onkeydown=function (e) {return viewlist.ViewListOnKeyDown (e);}
var isOnIOS=navigator.userAgent.match(/iPad/i)|| navigator.userAgent.match(/iPhone/i);if(!isOnIOS) {document.body.onbeforeunload=OnBeforeUnloadBody;window.onbeforeunload=OnBeforeUnloadBody;}
else {window.onpagehide=OnBeforeUnloadBody;window.onpageshow=function (e) {OnBeforeUnloadBodyFlag=0; return false;}}
/*
var arr=document.getElementsByTagName('a');for (var i in arr) {f=arr[i].onclick;if(f==null) arr[i].onclick=function () {sendConfiguration(); return true; };}
var el=document.getElementById('loginLink');if(el) el.onclick=function () {sendConfiguration(); return openLoginWindow (''); };*/
scheme.run ();ClearHistory ();Draw ();page.updateControls ();setInterval(sendConfiguration,600000);}function loadConfiguration () {xmlhttp=getXmlHttp();xmlhttp.open('GET', '/editor/api/?action=get&r='+Math.random(), false);xmlhttp.send(null);if(xmlhttp.status==200) {viewlist.ViewListClear ();setJSONConfiguration (xmlhttp.responseText);if(page.getViewPage()==0) {var startPage=0;for (var i in viewlist.list) {if(viewlist.list[i].classname==CLASSNAME_PAGE) {if((startPage>viewlist.list[i].page)||(startPage==0)) startPage=viewlist.list[i].page;}}
page.setViewPage(startPage);}}}function OnClickCancelViewSettings () {Actions_Close ();}
/*function OnMouseDownBody (event) {var e=event||window.event;if(e.bodynoclose!=1) {Actions_Close ();}
return true;}
*/function OnMouseMoveBody (event) {return onmousemoveControl (event);}function OnMouseUpBody (event) {if(!onmouseupControl (event)) return false;if(viewlist.mousedown!=0) {return viewlist.ViewListOnMouseUp (event);}
return true;}
var OnBeforeUnloadBodyFlag=0;function OnBeforeUnloadBody (event) {if(OnBeforeUnloadBodyFlag==0) {OnBeforeUnloadBodyFlag=1;try {sendConfiguration (false);}
catch (err) {sendConfiguration (true);}}}function PageWillClose () {OnBeforeUnloadBody (0);}function sendConfiguration (async) {if(typeof async=='undefined') async=true;var conf=getJSONConfiguration ();xmlhttp=getXmlHttp();xmlhttp.open('POST', '/editor/api/?action=set', async);xmlhttp.setRequestHeader('Content-Type', 'text/html; charset=utf-8');xmlhttp.send(conf);}function fillRoundedRect(x, y, w, h, r) {this.fillRoundedRect4 (x, y, w, h, r, r, r, r);}function fillRoundedRect4(x, y, w, h, r1, r2, r3, r4) {this.beginPath();this.moveTo(x+r1, y);this.lineTo(x+w-r2, y);if(r2>0) this.quadraticCurveTo(x+w, y, x+w, y+r2);this.lineTo(x+w, y+h-r3);if(r3>0) this.quadraticCurveTo(x+w, y+h, x+w-r3, y+h);this.lineTo(x+r4, y+h);if(r4>0) this.quadraticCurveTo(x, y+h, x, y+h-r4);this.lineTo(x, y+r1);if(r1>0) this.quadraticCurveTo(x, y, x+r1, y);this.fill();}
/*function CloseAllContextMenu () {Actions_Close ();}
*/function Unsaved (fl) {if(typeof fl=='undefined') fl=0;if((fl==0)||(fl==3)||((fl==2)&&(intermediateUnsaved==1))) {intermediateUnsaved=0;if(fl!=3) SaveHistory ();if(UnsavedProject==0) {UnsavedProject=1;DrawProjectName ();}
else UnsavedProject=1;}
else if(fl==1) {intermediateUnsaved=1;}
else if(fl==2) {intermediateUnsaved=0;}}function SaveHistory () {historyPosition++;var list=[];for (var i in viewlist.list) {list[i]= clone (viewlist.list[i]);}
historyArray[historyPosition]={'list': list};historyPositionMax=historyPosition;}function ClearHistory () {historyArray=[];historyPosition=-1;historyPositionMax=-1;SaveHistory ();}function GetHistoryUndo () {if(historyPosition>0) {historyPosition--;return historyArray[historyPosition];}
return null;}function GetHistoryRedo () {if(historyPosition<historyPositionMax) {historyPosition++;return historyArray[historyPosition];}
return null;}function CheckSignin (f) {if(typeof window['openLoginWindow']=='function') {if(f=='save') openLoginWindow ('Please login for save project');else if(f=='open') openLoginWindow ('Please login for open project');else openLoginWindow ('Please login');return false;}
else return true;}function newProject () {scheme=new Scheme ();settings=new Settings ();viewlist.ViewListClear ();NewProject=1;UnsavedProject=0;scheme.run ();updateEditorPage (1);ClearHistory ();Draw ();}function OnClickNewProject () {Actions_Close ();if(UnsavedProject!=0) {document.getElementById('win_nosave_button_save').onclick=function () {Windows_Close ('win_nosave');OnClickSaveProject (function () {newProject ();});return false;};document.getElementById('win_nosave_button_nosave').onclick=function () {Windows_Close ('win_nosave');newProject ();return false;};Windows_Open ('win_nosave');}
else {newProject ();}
return false;}function Save (f) {conf=getJSONConfiguration ();xmlhttp=getXmlHttp();xmlhttp.open('POST', '/editor/api/?action=save'+f, false);xmlhttp.setRequestHeader('Content-Type', 'text/html; charset=utf-8');xmlhttp.send(conf);var result='ERROR';if(xmlhttp.status==200) {result=xmlhttp.responseText;}
if(result=='OK') {UnsavedProject=0;NewProject=0;Draw ();}
else if(result!='EXIST') {Windows_Open ('win_saveerror');}
return result;}function OnClickSaveProject (backfunc) {if(NewProject==1) OnClickSaveProjectAs (backfunc);else {Actions_Close ();if(!CheckSignin ('save')) return false;result=Save ('&overwrite');if(result=='OK') {if(backfunc) backfunc ();}}
return false;}function OnClickSaveProjectAs (backfunc) {Actions_Close ();if(!CheckSignin ('save')) return false;document.getElementById('win_saveas_name').value=ProjectName;document.getElementById('win_saveas_button_save').onclick=function () {Windows_Close ('win_saveas');oldname=ProjectName;ProjectName=document.getElementById("win_saveas_name").value;result=Save ('');ProjectName=oldname;if(result=='EXIST') {document.getElementById('win_question_save_button_save').onclick=function () {Windows_Close ('win_question_save');ProjectName=document.getElementById("win_saveas_name").value;result=Save ('&overwrite');if(result=='OK') {if(backfunc) backfunc ();}};Windows_Open ('win_question_save');}
else if(result=='OK') {ProjectName=document.getElementById("win_saveas_name").value;if(backfunc) backfunc ();}
return false;};Windows_Open ('win_saveas');return false;}function OnClickOpenProject () {Actions_Close ();var href='/en/account/projects/';if(!CheckSignin ('open')) return false;if(UnsavedProject!=0) {document.getElementById('win_nosave_button_save').onclick=function () {Windows_Close ('win_nosave');OnClickSaveProject (function () {PageWillClose ();document.location.href=href;});return false;};document.getElementById('win_nosave_button_nosave').onclick=function () {Windows_Close ('win_nosave');PageWillClose ();document.location.href=href;return false;};Windows_Open ('win_nosave');}
else {PageWillClose ();document.location.href=href;}
return false;}function onclickGetSourceCode () {Actions_Close ();PageWillClose ();document.location.href="/en/editor/code/";return false;}
/*
Получить html для select
*/function getHTMLSelectOptions (value, array) {html='';for (var i in array) {if(array[i]!='') {html+="<option value=\""+i+"\""+((value==i)?" selected":"")+">"+array[i]+"</option>";}}
return html;}
/*
Получить html для select с первой строчкой "не выбран"
*/function getHTMLSelectOptionsFree (value, array) {return '<option value=\"\"'+((value=='')?" selected":"")+">-</option>"+getHTMLSelectOptions (value, array);}function DrawProjectName () {document.getElementById("projectname").innerHTML= ProjectName+((UnsavedProject==1)?' *':'');}function Draw () {DrawProjectName ();var display;if(settings.items.orientation==ORIENTATION_BOTH) display="block";else display="none";elButtonHorizontal.style.display=display;elButtonVertical.style.display=display;if(viewlist) viewlist.ViewListDraw ();}function serializeJSON (value, tab) {if(tab===undefined) tab='';var json="", _tab, cnt=0;if(value instanceof Array) {_tab=tab+" ";for (var i in value) {if(json=='') json="[\n";else json+=",\n";json+=_tab+serializeJSON (value[i], _tab);cnt++;}
if(cnt>0) json+="\n"+tab+"]";else json="[]";}
else if(typeof value=="object") {_tab=tab+" ";for (var name in value) {if(json=='') json="{\n";else json+=",\n";json+=_tab+"\""+name+"\":"+serializeJSON (value[name], _tab);cnt++;}
if(cnt>0) json+="\n"+tab+"}";else json="{}";}
else if(typeof value=="string") {value=value.replace(new RegExp('\\\\',"g"), "\\u005C");value=value.replace(new RegExp("\"","g"), "\\u0022");json="\""+value+"\"";}
else {json=value;}
return json;}function parseJSON (json, pos) {if(pos===undefined) pos={"v":0};var value, ch, k, name;var len=json.length;while (pos.v<=len) {ch=json.substr(pos.v++,1);if((ch!=" ")&&(ch!="\n")) break;}
if(pos.v-1>len) return undefined;if(ch=="[") {value=new Array ();while (1==1) {while (pos.v<=len) {ch=json.substr(pos.v,1);if(ch=="]") { pos.v++; return value; }
if((ch!=" ")&&(ch!="\n")) break;pos.v++;}
if(pos.v-1>len) return undefined;if((value[value.length]=parseJSON (json, pos))==undefined) return undefined;while (pos.v<=len) {ch=json.substr(pos.v++,1);if(ch==",") break;if(ch=="]") return value;if((ch!=" ")&&(ch!="\n")) return undefined;}
if(pos.v-1>len) return undefined;}}
else if(ch=="{") {value={};while (1==1) {while (pos.v<=len) {ch=json.substr(pos.v++,1);if(ch=="\"") break;if((ch!=" ")&&(ch!="\n")) return undefined;}
if(pos.v-1>len) return undefined;k=json.indexOf ("\"",pos.v);if(k>=0) {name=json.substr(pos.v,k-pos.v);pos.v=k+1;}
while (pos.v<=len) {ch=json.substr(pos.v++,1);if(ch==":") break;if((ch!=" ")&&(ch!="\n")) return undefined;}
if(pos.v-1>len) return undefined;if((value[name]=parseJSON (json, pos))==undefined) return undefined;while (pos.v<=len) {ch=json.substr(pos.v++,1);if(ch==",") break;if(ch=="}") return value;if((ch!=" ")&&(ch!="\n")) return undefined;}
if(pos.v-1>len) return undefined;}}
else if(ch=="\"") {k=json.indexOf ("\"",pos.v);if(k>=0) {value=json.substr(pos.v,k-pos.v);value=value.replace(new RegExp("\\\\u0022","g"), "\"");value=value.replace(new RegExp("\\\\u005C","g"), "\\");pos.v=k+1;return value;}
else return undefined;}
else if((ch>='0')&&(ch<='9')||(ch=='-')||(ch=='.')) {value=ch;while (pos.v<=len) {ch=json.substr(pos.v,1);if((ch>='0')&&(ch<='9')||(ch=='.')) value+=ch;else break;pos.v++;}
if(value.indexOf (".")<0) value=parseInt(value);else value=parseFloat(value);if(value==NaN) return undefined;return value;}
return undefined;}function clone (obj) {if(obj==null) return null;else if(obj.classname===undefined) var temp={};else var temp=new window[obj.classname]();for(var key in obj)if(typeof obj[key]=="object") temp[key]=clone (obj[key]);else temp[key]=obj[key];return temp;}function updateObject (obj, stucture) {for (var item in stucture) {if(obj[item]!=undefined) {if((typeof obj[item]=="object")&&(typeof stucture[item]=="object")) {updateObject (obj[item], stucture[item]);}
else obj[item]=stucture[item];}}}function getFirstPropertyName (obj) {for (var i in obj) return i;return undefined;}function openLeftCol () {var ws=document.getElementById('windows_place');var el=document.getElementById('editor_leftcol');if(el) {ws.appendChild (el);Windows_OpenAsMenu ('editor_leftcol', 0);}}function openRightCol () {var ws=document.getElementById('windows_place');var el=document.getElementById('editor_rightcol');if(el) {ws.appendChild (el);Windows_OpenAsMenu ('editor_rightcol', 1);}}
var ColorBlackID=24;var ColorWhiteID=31;var ColorGreyID=26;var ColorsInt={0 : {1:0x393939, 2:0xDDDDDD, 3:0xAEAEAE, 4:0xC6C6C6},1 : {1:0x9A0F0F, 2:0xFFAEAE, 3:0xED1111, 4:0xFF5555},2 : {1:0xB05037, 2:0xFCEFBA, 3:0xFF8D20, 4:0xFCBD3C},3 : {1:0x6E7120, 2:0xFBFF8D, 3:0xDFE52F, 4:0xEDF42A},4 : {1:0x276E36, 2:0xE1FDA8, 3:0x7CB264, 4:0xB8D696},5 : {1:0x394B8B, 2:0xD8E1FF, 3:0x6D9CD4, 4:0x96BCE1},6 : {1:0x000073, 2:0xAAAAEB, 3:0x1D1DCD, 4:0x4343E6},7 : {1:0x744F70, 2:0xFFE0DA, 3:0xAD689E, 4:0xDC96AE}};var ColorsTable=[
0xAEAEAE, 0xED1111, 0xFF8D20, 0xDFE52F, 0x7CB264, 0x6D9CD4, 0x1D1DCD, 0xAD689E,0x292929, 0x9B3B3B, 0xCE9600, 0xB2B400, 0x1C8200, 0x019A91, 0x4856AE, 0x9A017F,0xF2F2F2, 0xFFC790, 0xFFE0E0, 0xFEFFAE, 0xC0FFBB, 0xBBFFF3, 0xD3C4FF, 0xFDD1FA,0x000000, 0x242424, 0x484848, 0x6C6C6C, 0x919191, 0xB6B6B6, 0xDADADA, 0xFFFFFF,0x3F0000, 0x700000, 0xA00000, 0xD10000, 0xFF0000, 0xFF2B2B, 0xFF5656, 0xFF8282, 0xFFADAD, 0xFFD8D8, 0xE2AEAE, 0xC78989, 0xAD7171, 0x8B5858,0x4C1300, 0x7A1E00, 0xA82A00, 0xD63500, 0xFF3F00, 0xFF602B, 0xFF8056, 0xFFA182, 0xFFC1AD, 0xFFE2D8, 0xE6BCAD, 0xC89888, 0xAE8273, 0x896559,0x3F1F00, 0x703800, 0xA05000, 0xD16800, 0xFF7F00, 0xFF952B, 0xFFAA56, 0xFFC082, 0xFFD6AD, 0xFFEBD8, 0xE4C7AC, 0xC5A586, 0xAB8E73, 0x8B7159,0x332600, 0x664C00, 0x997200, 0xCC9900, 0xFFBF00, 0xFFCA2B, 0xFFD456, 0xFFDF82, 0xFFEAAD, 0xFFF5D8, 0xEADBAF, 0xC6B689, 0xAA9C72, 0x887B56,0x333300, 0x545400, 0x838300, 0xBABA02, 0xD5D502, 0xEEEE00, 0xFFFF00, 0xFFFF49, 0xFFFF91, 0xFFFFD8, 0xE7E7AF, 0xC6C687, 0xAFAF75, 0x8B8B59,0x293F00, 0x446000, 0x658800, 0x88B700, 0xA8D600, 0xCFFF00, 0xD0FF20, 0xDAFF5A, 0xE8FF9A, 0xF3FFD3, 0xD8E8AE, 0xB5C589, 0x9BAB72, 0x7B8956,0x1F3F00, 0x336600, 0x468C00, 0x59B200, 0x6CD800, 0x7FFF00, 0x9BFF38, 0xB6FF6D, 0xD1FFA3, 0xEBFFD8, 0xC6E4AA, 0xA6C688, 0x8DAB71, 0x728D59,0x003300, 0x005B00, 0x008400, 0x00AD00, 0x00D600, 0x00FF00, 0x38FF38, 0x6DFF6D, 0xA3FFA3, 0xD8FFD8, 0xADE5AD, 0x8AC88A, 0x73AD73, 0x578857,0x002613, 0x005128, 0x007C3E, 0x00A854, 0x00D369, 0x00FF7F, 0x38FF9B, 0x6DFFB6, 0xA3FFD1, 0xD8FFEB, 0xAEE4C8, 0x89C6A7, 0x71AA8D, 0x5A8C72,0x00332A, 0x005446, 0x007561, 0x00967D, 0x00C5A5, 0x00E6C0, 0x00FFD4, 0x49FFE0, 0x91FFEC, 0xD8FFF8, 0xB1E7DD, 0x8AC5BA, 0x72ADA2, 0x588980,0x002133, 0x003D5B, 0x005884, 0x0073AD, 0x008ED6, 0x00A9FF, 0x38BCFF, 0x6DCEFF, 0xA3E0FF, 0xD8F2FF, 0xAED4E7, 0x86B0C5, 0x7197AA, 0x597989,0x001133, 0x002266, 0x003399, 0x0044CC, 0x0055FF, 0x2B71FF, 0x568EFF, 0x82ABFF, 0xADC8FF, 0xD8E5FF, 0xABBFE6, 0x8A9DC5, 0x788AAE, 0x5D6D8C,0x00003F, 0x000070, 0x0000A0, 0x0000D1, 0x0000FF, 0x2B2BFF, 0x5656FF, 0x8282FF, 0xADADFF, 0xD8D8FF, 0xADADE5, 0x8989C6, 0x7575AF, 0x5D5D8C,0x190033, 0x330066, 0x4C0099, 0x6600CC, 0x7F00FF, 0x952BFF, 0xAA56FF, 0xC082FF, 0xD6ADFF, 0xEBD8FF, 0xC8ADE4, 0xA588C4, 0x8F72AD, 0x705988,0x330033, 0x5B005B, 0x840084, 0xAD00AD, 0xD600D6, 0xFF00FF, 0xFF38FF, 0xFF6DFF, 0xFFA3FF, 0xFFD8FF, 0xE3A8E3, 0xC689C6, 0xAA71AA, 0x8A598A,0x330019, 0x660033, 0x99004C, 0xCC0066, 0xFF007F, 0xFF2B95, 0xFF56AA, 0xFF82C0, 0xFFADD6, 0xFFD8EB, 0xE6B2CB, 0xC78BA8, 0xAC748F, 0x8D5C74
];function moveColor (color, move) {var r=((color>>16) & 0xff)/255;var g=((color>>8) & 0xff)/255;var b=(color & 0xff)/255;var ir, ig, ib;if(move<0) {move=move+1;ir=Math.round(r*move*255);ig=Math.round(g*move*255);ib=Math.round(b*move*255);}
else {ir=Math.round((r+(1-r)*move)*255);ig=Math.round((g+(1-g)*move)*255);ib=Math.round((b+(1-b)*move)*255);}
return (ir<<16) | (ig<<8) | ib;}function getDifferColor (color, move) {var r=((color>>16) & 0xff);var g=((color>>8) & 0xff);var b=(color & 0xff);if((r>250)||(g>250)||(b>250)) return moveColor (color, -move);return moveColor (color, move);}function getBlackOrWhiteColor (color) {var r=((color>>16) & 0xff);var g=((color>>8) & 0xff);var b=(color & 0xff);if((r<180)||(g<180)||(b<180)) return 0xffffff;return 0x000000;}function getStyleColor (color) {return "#"+("000000"+color.toString(16)).substr (-6);}function getColorByID (colorID) {if(colorID<0) return 0xffffff;return ColorsTable[colorID];}function getColorToneByID (colorID, tone) {if(typeof tone=="undefined") {tone=3;}
if(colorID<8) {return ColorsInt[colorID][tone];}
var color=getColorByID (colorID, 0);if(tone==1) return moveColor (color, -0.37);else if(tone==2) return moveColor (color, 0.67);else if(tone==4) return moveColor (color, 0.37);return color;}
var SelectChars=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P"];var GROUP_CONTROLS='controls';var GROUP_INDICATIONS='indications';var GROUP_NOTIFICATIONS='notifications';var GROUP_DECORATIONS='decorations';var CLASSNAME_PAGE="ControlPage";var rgbImage=new Image ();rgbImage.src   ='/img/editor/rgbw_500.png';var TEXT_BASE_LINE=0.52;var TEXT_FONT_SIZE=0.8;function Control () {this.classname="Control";this.group="";this.variabletype="Control";this.variable="";this.drawtype=0;this.select_x=0;this.select_y=0;this.select_w=0;this.select_h=0;this.pin='';this.left=0;this.top=0;this.width=10;this.height=10;this.h_left=0;this.h_top=0;this.h_width=0;this.h_height=0;this.v_left=0;this.v_top=0;this.v_width=0;this.v_height=0;this.minwidth=3;this.minheight=3;this.color=2;this.backgroundcolor=ColorGreyID;this.textcolor=ColorWhiteID;this.haveColor=true;this.haveBackgroundcolor=false;this.name="";this.text="";this.img="/img/views/free.png";this.page=0;this.loadOrientation=function () {var or=page.getViewOrientation();if(or==ORIENTATION_HORIZONTAL) {this.left=this.h_left;this.top=this.h_top;this.width=this.h_width;this.height=this.h_height;}
else {this.left=this.v_left;this.top=this.v_top;this.width=this.v_width;this.height=this.v_height;}}
this.saveOrientation=function () {var or=page.getViewOrientation();if(or==ORIENTATION_HORIZONTAL) {this.h_left=this.left;this.h_top=this.top;this.h_width=this.width;this.h_height=this.height;}
else {this.v_left=this.left;this.v_top=this.top;this.v_width=this.width;this.v_height=this.height;}}
this.createNew=function () {var or=page.getViewOrientation();this.h_left=this.left;this.h_top=this.top;this.h_width=this.width;this.h_height=this.height;this.v_left=this.left;this.v_top=this.top;this.v_width=this.width;this.v_height=this.height;if(or==ORIENTATION_HORIZONTAL) {if(this.v_left>MAX_Y-10) this.v_left=MAX_Y-10;}
else {if(this.h_top>MAX_X-10) this.h_top=MAX_X-10;}}
this.ControlSelect=function (x, y) {var x1=this.left *contextStep;var y1=this.top*contextStep;var x2=(this.left+this.width)*contextStep;var y2=(this.top+this.height)*contextStep;if((x>=x1)&&(x<=x2)&&(y>=y1)&&(y<=y2)) return 1;return 0;}
this.ControlSelectGroup=function (x, y, dx, dy, mode) {var x1=this.left *contextStep;var y1=this.top*contextStep;var x2=(this.left+this.width)*contextStep;var y2=(this.top+this.height)*contextStep;if(mode>=0) {if((x<=x1)&&(x+dx>=x2)&&(y<=y1)&&(y+dy>=y2)) return 1;}
else {if((x<=x2)&&(x+dx>=x1)&&(y<=y2)&&(y+dy>=y1)) return 1;}
return 0;}
this.ControlSelectResize=function (x, y) {var x1=this.left *contextStep;var y1=this.top*contextStep;var x2=(this.left+this.width)*contextStep;var y2=(this.top+this.height)*contextStep;var r=MARKER_SIZE;if((x>=x1-r)&&(x<=x1+r)&&(y>=y1-r)&&(y<=y1+r)) return 2;if((x>=x2-r)&&(x<=x2+r)&&(y>=y1-r)&&(y<=y1+r)) return 3;if((x>=x2-r)&&(x<=x2+r)&&(y>=y2-r)&&(y<=y2+r)) return 4;if((x>=x1-r)&&(x<=x1+r)&&(y>=y2-r)&&(y<=y2+r)) return 5;return 0;}
this.SavePosition =function () {this.select_x=this.left*contextStep;this.select_y=this.top*contextStep;this.select_w=this.width*contextStep;this.select_h=this.height*contextStep;}
this.GetPreferenceWidth=null;this.GetPreferenceHeight=null;this.ControlDraw=function (cont) {}
this.ControlDrawSelect=function (cont, mode) {var x1=this.left *contextStep;var y1=this.top*contextStep;var x2=(this.left+this.width)*contextStep;var y2=(this.top+this.height)*contextStep;var r=MARKER_SIZE;context.lineCap="butt";if(mode==0) {cont.beginPath();cont.strokeStyle="#0000ff";cont.lineWidth=1;cont.strokeRect(x1-r,y1-r,r*2,r*2);cont.strokeRect(x2-r,y1-r,r*2,r*2);cont.strokeRect(x2-r,y2-r,r*2,r*2);cont.strokeRect(x1-r,y2-r,r*2,r*2);cont.moveTo(x1+r, y1);cont.lineTo (x2-r, y1);cont.moveTo(x2, y1+r);cont.lineTo (x2, y2-r);cont.moveTo(x2-r, y2);cont.lineTo (x1+r, y2);cont.moveTo(x1, y2-r);cont.lineTo (x1, y1+r);cont.closePath();cont.stroke();if(this.variabletype!="") {cont.fillStyle="#000000";cont.textBaseline='center';cont.textAlign='center';cont.font=''+FONT_SIZE+'px arial';var ty=y1-FONT_SIZE*0.9;if(this.pin!='') {cont.fillText ('pin '+scheme.getPins()[this.pin], (x1+x2)/2, ty);ty=y1-FONT_SIZE*2;}
cont.fillText (this.variable, (x1+x2)/2, ty);}}
else {cont.beginPath();cont.strokeStyle="#0000ff";cont.lineWidth=1;cont.strokeRect(x1,y1,x2-x1,y2-y1);cont.closePath();cont.stroke();}}
this.getConfiguration=function () {var conf={"name":this.classname,"v_left":this.v_left,"v_top":this.v_top,"v_width":this.v_width,"v_height":this.v_height,"h_left":this.h_left,"h_top":this.h_top,"h_width":this.h_width,"h_height":this.h_height,"page":this.page};if(this.variabletype!="") {conf['variable']=this.variable;}
if(this.haveColor) {conf['color']=this.color;}
if(this.haveBackgroundcolor) {conf['backgroundcolor']=this.backgroundcolor;}
return conf;}
this.setConfiguration=function (conf) {var name;if(conf.backgroundcolor!=undefined) {this.backgroundcolor=conf.backgroundcolor;if(ProjectVersion<8) this.backgroundcolor+=8;}
if(conf.color!=undefined) {this.color=conf.color;if(ProjectVersion<8) {if((this.classname=='ControlLabel')||(this.classname=='ControlPanel')) this.color+=8;}}
var a=["variable","page","v_left","v_top","v_width","v_height","h_left","h_top","h_width","h_height"];for (var i in a) {name=a[i];if(conf[name]!=undefined) this[name]=conf[name];}
a=["left","top","width","height"];for (var i in a) {name=a[i];if(conf[name]!=undefined) {this['v_'+name]=conf[name];this['h_'+name]=conf[name];if(name=="left") {if(this.v_left>55) this.v_left=55;}}}
this.loadOrientation ();}
this.GetHTMLSettings=function () {html='';if(this.variabletype!="") {html+=getHTMLSettingsText ('Variable name (C++ rules)', 'el_variable', this.variable);}
return html;}
this.SetSettings=null;this.SetSetting=function (id) {if(id=='el_variable') {inputtext=document.getElementById(id);var variable=inputtext.value;var err=false;if(variable=='') err=true;else {for (var i=0; i<variable.length; i++) {ch=variable.substr(i,1);if(!(((ch>='a')&&(ch<='z'))||
((ch>='A')&&(ch<='Z'))||
((ch>='0')&&(ch<='9')&&(i>0))||
(ch=='_'))) {err=true;break;}}}
if(err) {inputtext.style.background="#FFC0C0";return false;}
this.variable=inputtext.value;}
else if((id.substr(0,9)=='el_color_')&&(this.haveColor)) {value=id.substr(9,id.length);this.color=parseInt (value);}
else if((id.substr(0,19)=='el_backgroundcolor_')&&(this.haveBackgroundcolor)) {value=id.substr(19,id.length);this.backgroundcolor=parseInt (value);}
else if(id.substr(0,13)=='el_textcolor_') {value=id.substr(13,id.length);this.textcolor=parseInt (value);}
else if(id=='el_page') {if(this.classname!=CLASSNAME_PAGE) {var page=parseInt (document.getElementById(id).value);var pages=viewlist.getPages ();if(pages!=null)if(pages[page]!=undefined)   this.page=page;}}
return true;}
this.setDefaultPin=function () {return;/*
var f=0;for (var i in viewlist.list) {curview=viewlist.list[i];if((curview.classname=="ControlButton")||(curview.classname=="ControlSwitch")) f=1;}
if(f==0) this.pin=scheme.getDefaultPin ();*/}}
ControlButton.prototype=new Control ();function ControlButton (drawtype) {this.classname="ControlButton";this.group=GROUP_CONTROLS;this.variabletype="button";this.width=12;this.height=12;this.name='Button';this.text="X";this.drawtype=drawtype;this.bordertype=0;this.img="/img/views2/button.png";this.createNew=function () {if(!Object.getPrototypeOf(this).createNew.apply(this));this.setDefaultPin ();}
this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['text']=this.text;conf['drawtype']=this.drawtype;conf['bordertype']=this.bordertype;conf['textcolor']=this.textcolor;conf['pin']=this.pin;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.text!=undefined) this.text=conf.text;if(conf.drawtype!=undefined) this.drawtype=conf.drawtype;if(conf.bordertype!=undefined) this.bordertype=conf.bordertype;if(conf.textcolor!=undefined) this.textcolor=conf.textcolor;if(conf.pin!=undefined) this.pin=conf.pin;}
this.GetPreferenceWidth=function (cont, w, h) {if(this.drawtype==0) return h;else return w;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top*contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var cx=x+w/2;var cy=y+h/2;var fy=y+h/1.9;var wt=w*0.8;var color=getColorToneByID (this.color,3);var borderColor=color;if(this.bordertype==0) borderColor=getColorToneByID (this.color,1);else if(this.bordertype==2) borderColor=getColorToneByID (this.color,2);var fontColor=getColorByID (this.textcolor);if(this.drawtype==0) {var r=Math.min (w, h)/2;cont.beginPath();cont.fillStyle=getStyleColor(borderColor);cont.arc (cx, cy, r, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor(color);cont.arc (cx, cy, r*0.9, 0, Math.PI*2);cont.fill();}
else if(this.drawtype==1) {var br=Math.min (w, h);cont.fillStyle=getStyleColor(borderColor);cont.fillRoundedRect(x, y, w, h, Math.min (w, h)*0.1);var tx=x+br*0.05; ty=y+br*0.05;var tw=w-br*0.1; th=h-br*0.1;cont.fillStyle=getStyleColor(color);cont.fillRoundedRect(tx, ty, tw, th, Math.min (tw, th)*0.1);}
else {var r=Math.min (w, h)/2*0.97;cont.fillStyle=getStyleColor(borderColor);cont.fillRoundedRect(x, y, w, h, r);var t=r*0.1;var t2=t*2;cont.fillStyle=getStyleColor(color);cont.fillRoundedRect(x+t, y+t, w-t2, h-t2, r-t);}
if(this.text!="") {cont.fillStyle=getStyleColor (fontColor);cont.textBaseline='middle';cont.textAlign='center';var maxf=h*0.75;cont.font='bold '+Math.round (maxf)+'px arial';dw=cont.measureText(this.text).width;var f=maxf*wt/dw;if(this.drawtype==0) {var tr=f*f+wt*wt;if(tr>maxf*maxf) f=f*Math.sqrt(maxf*maxf/tr);}
if(f>maxf) f=maxf;cont.font='bold '+Math.round (f)+'px arial';cont.fillText (this.text, cx, fy);}}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsText   ('Caption', 'el_text', this.text);html+=getHTMLSettingsColor  ("","el_textcolor", this.textcolor, 0);html+=getHTMLSettingsSelect ('Draw type', 'el_drawtype', getHTMLSelectOptions (this.drawtype, {0:'Round',1:'Rectangular',2:'Ellipse'}));html+=getHTMLSettingsSelect ('Border style', 'el_bordertype', getHTMLSelectOptions (this.bordertype, {0:'Dark',1:'None',2:'Light'}));html+=getHTMLSettingsSelect ('Snap to pin', 'el_pin', getHTMLSelectOptionsFree (this.pin, scheme.getPins()));return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_text') this.text=document.getElementById(id).value;else if(id=='el_drawtype') {this.drawtype=parseInt (document.getElementById(id).value);if(this.drawtype==0) this.height=this.width;}
else if(id=='el_bordertype') this.bordertype=parseInt (document.getElementById(id).value);else if(id=='el_pin') this.pin=document.getElementById(id).value;return true;}}
ControlSwitch.prototype=new Control ();function ControlSwitch (drawtype) {this.classname="ControlSwitch";this.group=GROUP_CONTROLS;this.variabletype="switch";this.width=22;this.height=11;this.minwidth=10;this.minheight=5;this.name='Switch';this.texton="ON";this.textoff="OFF";this.textcoloron=ColorWhiteID;this.textcoloroff=ColorWhiteID;this.drawtype=drawtype;this.haveBackgroundcolor=true;this.img="/img/views2/switch.png";this.createNew=function () {if(!Object.getPrototypeOf(this).createNew.apply(this));this.setDefaultPin ();}
this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['texton']=this.texton;conf['textoff']=this.textoff;conf['drawtype']=this.drawtype;conf['textcoloron']=this.textcoloron;conf['textcoloroff']=this.textcoloroff;conf['pin']=this.pin;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.texton!=undefined) this.texton=conf.texton;if(conf.textoff!=undefined) this.textoff=conf.textoff;if(conf.drawtype!=undefined) this.drawtype=conf.drawtype;if(conf.textcoloron!=undefined) this.textcoloron=conf.textcoloron;if(conf.textcoloroff!=undefined) this.textcoloroff=conf.textcoloroff;if(conf.pin!=undefined) this.pin=conf.pin;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var d=Math.min (this.height, this.width)*0.05*contextStep;var color=getColorToneByID (this.color,3);var fontColor=getColorToneByID (this.textcoloron);var backgroundColor=getColorByID (this.backgroundcolor);cont.fillStyle=getStyleColor (backgroundColor);if(this.drawtype==0) {cont.fillRect(x, y, w, h);cont.fillStyle=getStyleColor (color);cont.fillRoundedRect(x+w/2+d, y+d, w/2-2*d, h-d*2, d*2);}
else  {var r=Math.min (w/2, h)/2*0.97;cont.fillRoundedRect(x, y, w, h, r);var r=r*0.9;cont.fillStyle=getStyleColor(color);cont.fillRoundedRect(x+w/2+d, y+d, w/2-2*d, h-d*2, r);}
cont.textBaseline='middle';cont.textAlign='center';var maxf=h*0.75;cont.font='bold '+Math.round (maxf)+'px arial';var dw1=cont.measureText(this.texton).width;var dw2=cont.measureText(this.textoff).width;var wt=w*0.4;var f=maxf*wt/Math.max(dw1, dw2);if(f>maxf) f=maxf;cont.font='bold '+Math.round (f)+'px arial';cont.fillStyle=getStyleColor (fontColor);cont.fillText (this.texton, x+w*3/4, y+h/2);cont.fillStyle=getStyleColor (getDifferColor (backgroundColor, 0.2));cont.fillText (this.textoff, x+w*1/4, y+h/2);}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsText   ('Caption in \"ON\"', 'el_texton', this.texton);html+=getHTMLSettingsColor  ("","el_textcoloron", this.textcoloron, 0);html+=getHTMLSettingsText   ('Caption in \"OFF\"', 'el_textoff', this.textoff);html+=getHTMLSettingsColor  ("","el_textcoloroff", this.textcoloroff, 0);html+=getHTMLSettingsSelect ('Draw type', 'el_drawtype', getHTMLSelectOptions (this.drawtype, {0:'Rectangular',1:'Ellipse'}));html+=getHTMLSettingsSelect ('Snap to pin', 'el_pin', getHTMLSelectOptionsFree (this.pin, scheme.getPins()));return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_texton') this.texton=document.getElementById(id).value;else if(id=='el_textoff') this.textoff=document.getElementById(id).value;else if(id=='el_drawtype') this.drawtype=parseInt (document.getElementById(id).value);else if(id=='el_pin') this.pin=document.getElementById(id).value;else if(id.substr(0,15)=='el_textcoloron_') {value=id.substr(15,id.length);this.textcoloron=parseInt (value);}
else if(id.substr(0,16)=='el_textcoloroff_') {value=id.substr(16,id.length);this.textcoloroff=parseInt (value);}
return true;}}
ControlSelect.prototype=new Control ();function ControlSelect (drawtype) {this.classname="ControlSelect";this.group=GROUP_CONTROLS;this.variabletype="select";this.width=8;this.height=22;this.minwidth=2;this.minheight=4;this.name='Select';this.positions=3;this.orientation=0;this.haveBackgroundcolor=true;this.img="/img/views2/select.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['positions']=this.positions;conf['orientation']=this.orientation;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.positions!=undefined) this.positions=conf.positions;if(conf.orientation!=undefined) this.orientation=conf.orientation;}
this.GetPreferenceWidth=function (cont, w, h) {if(this.orientation==0) return Math.round(h/this.positions*1.1);else return w;}
this.GetPreferenceHeight=function (cont, w, h) {if(this.orientation!=0) return Math.round(w/this.positions*1.1);else return h;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var r, k;if(this.orientation==0) {r=h/this.positions*0.55;k=(h-r*2)/(this.positions-1);}
else {r=w/this.positions*0.55;k=(w-r*2)/(this.positions-1);}
var backgroundColor=getColorByID (this.backgroundcolor);var diffColor=getStyleColor (getDifferColor (backgroundColor, 0.2));cont.beginPath();cont.fillStyle=getStyleColor (backgroundColor);for (i=0; i<this.positions; i++)if(this.orientation==0) cont.arc (x+r, y+k*i+r, r, 0, Math.PI*2);else cont.arc (x+k*i+r, y+r, r, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (diffColor);for (i=0; i<this.positions; i++)if(this.orientation==0) cont.arc (x+r, y+k*i+r, r*0.7, 0, Math.PI*2);else cont.arc (x+k*i+r, y+r, r*0.7, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (backgroundColor);for (i=0; i<this.positions; i++) {if(this.orientation==0) cont.arc (x+r, y+k*i+r, r*0.6, 0, Math.PI*2);else cont.arc (x+k*i+r, y+r, r*0.6, 0, Math.PI*2);}
cont.fill();cont.textBaseline='middle';cont.textAlign='center';font=Math.round (r*0.9);cont.font='bold '+font+'px arial';cont.fillStyle=getStyleColor (diffColor);for (var i=0; i<this.positions; i++) {if(this.orientation==0) cont.fillText (SelectChars[i], x+r, y+k*i+r);else cont.fillText (SelectChars[i], x+k*i+r, y+r);}
cont.beginPath();cont.fillStyle=getStyleColor (getColorToneByID (this.color,3));cont.arc (x+r, y+r, r*0.8, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (getColorToneByID (this.color,2));cont.arc (x+r, y+r, r*0.8, -2.8, -1.2);cont.fill();}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);sel={};for (i=2; i<=10; i++) sel[i]=''+i;html+=getHTMLSettingsSelect ('Count of positions', 'el_positions', getHTMLSelectOptions (this.positions, sel));html+=getHTMLSettingsSelect ('Orientation', 'el_orientation', getHTMLSelectOptions (this.orientation, {0:'Vertical',1:'Horisontal'}));return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_positions') {this.positions=parseInt (document.getElementById(id).value);if(isNaN(this.positions)) this.positions=2;if(this.positions<2) this.positions=2;if(this.positions>10) this.positions=10;this.width=this.GetPreferenceWidth (context, this.width, this.height);this.height=this.GetPreferenceHeight (context, this.width, this.height);}
if(id=='el_orientation') {var orientation=(document.getElementById(id).value==0)?0:1;if(orientation!=this.orientation) {width=this.width;this.width=this.height;this.height=width;}
this.orientation=orientation;this.width=this.GetPreferenceWidth (context, this.width, this.height);}
return true;}}
ControlSlider.prototype=new Control ();function ControlSlider (drawtype) {this.classname="ControlSlider";this.group=GROUP_CONTROLS;this.variabletype="slider";this.width=7;this.height=18;this.minwidth=5;this.minheight=5;this.name='Slider';this.orientation=0;this.autocentering=0;this.center=0;this.haveBackgroundcolor=true;this.img="/img/views2/slider.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['orientation']=this.orientation;conf['autocentering']=this.autocentering;conf['center']=this.center;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.orientation!=undefined) this.orientation=conf.orientation;if(conf.autocentering!=undefined) this.autocentering=conf.autocentering;if(conf.center!=undefined) this.center=conf.center;}
this.GetPreferenceWidth=function (cont, w, h) {if(this.orientation==0) {k=h/w;if(h/w>3) return w;return Math.round (h/3);}
else return w;}
this.GetPreferenceHeight=function (cont, w, h) {if(this.orientation!=0) {k=w/h;if(w/h>3) return h;return Math.round (w/3);}
else return h;}
this.ControlDraw=function (cont) {var w=this.width*contextStep;var h=this.height*contextStep;var x, y, r, m;if(this.orientation==0) {x=(this.left+this.width/2)*contextStep;y=this.top *contextStep;r=w/2;m=w*0.05;}
else {x=this.left *contextStep;y=(this.top+this.height/2) *contextStep;r=h/2;m=h*0.05;}
cont.fillStyle=getStyleColor (getColorByID (this.backgroundcolor));if(this.orientation==0) {cont.fillRect(x-m, y+r, m*2, h-r*2);tx=x;ty=y+h/2-(h/2-r)*(this.center-1);}
else {cont.fillRect(x+r, y-m, w-r*2, m*2);tx=x+w/2+(w/2-r)*(this.center-1);ty=y;}
cont.beginPath();cont.fillStyle=getStyleColor (getColorToneByID (this.color,3));cont.arc (tx, ty, r, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (getColorToneByID (this.color,2));cont.arc (tx, ty, r, -2.8, -1.2);cont.fill();}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsSelect ('Orientation', 'el_orientation', getHTMLSelectOptions (this.orientation, {0:'Vertical',1:'Horisontal'}));var values;if(this.orientation==0) values={0:'Bottom',1:'Middle',2:'Top'};else values={0:'Left',1:'Middle',2:'Right'};html+=getHTMLSettingsSelect ('Сenter position', 'el_center', getHTMLSelectOptions (this.center, values));html+=getHTMLSettingsCheckbox ('Automatically center', 'el_autocentering', this.autocentering);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_orientation') {var orientation=(document.getElementById(id).value==0)?0:1;if(orientation!=this.orientation) {width=this.width;this.width=this.height;this.height=width;}
this.orientation=orientation;this.width=this.GetPreferenceWidth (context, this.width, this.height);}
if(id=='el_center') this.center=parseInt (document.getElementById(id).value);if(id=='el_autocentering') this.autocentering=document.getElementById(id).checked?1:0;return true;}}
ControlJoystick.prototype=new Control ();function ControlJoystick (drawtype) {this.classname="ControlJoystick";this.group=GROUP_CONTROLS;this.variabletype="joystick";this.width=30;this.height=30;this.proporcional=1;this.minwidth=10;this.minheight=10;this.name='Joystick';this.centerpos=0;this.gsensorpos=0;this.autocentering=0;this.haveBackgroundcolor=true;this.img="/img/views2/joystick.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['centerpos']=this.centerpos;conf['gsensorpos']=this.gsensorpos;conf['autocentering']=this.autocentering;conf['textcolor']=this.textcolor;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.centerpos!=undefined) {this.centerpos=conf.centerpos;if(ProjectVersion<=2) this.autocentering=(this.centerpos==0)?1:0;}
if(conf.gsensorpos!=undefined) this.gsensorpos=conf.gsensorpos;if(conf.autocentering!=undefined) this.autocentering=conf.autocentering;if(conf.textcolor!=undefined) this.textcolor=conf.textcolor;}
this.GetPreferenceWidth=function (cont, w, h) {return h;}
this.ControlDraw=function (cont) {var x=(this.left+this.width/2)*contextStep;var y=(this.top+this.height/2)*contextStep;var r=this.width*contextStep /2;var d=this.width*0.15*contextStep;var br=r*0.4;var color=getColorToneByID (this.color,3);var borderColor=getColorToneByID (this.color,1);var backgroundColor=getColorByID (this.backgroundcolor);var diffColor=getStyleColor (getDifferColor (backgroundColor, 0.2));var fontColor=getColorToneByID (this.textcolor);if(this.centerpos>0) {var a=(this.centerpos-1)*Math.PI/2-Math.PI/4;var bx=x+(r*1.1)*Math.cos(a);var by=y+(r*1.1)*Math.sin(a);var tx=x+(r*1.2)*Math.cos(a);var ty=y+(r*1.2)*Math.sin(a);cont.beginPath();cont.fillStyle=getStyleColor (borderColor);cont.arc (bx, by, br, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (color);cont.arc (bx, by, br*0.9, 0, Math.PI*2);cont.fill();cont.fillStyle=getStyleColor (fontColor);cont.textBaseline='middle';cont.textAlign='center';cont.font='bold '+Math.round (br*1.2)+'px arial';cont.fillText ('C', tx, ty);}
if(this.gsensorpos>0) {var a=(this.gsensorpos-1)*Math.PI/2-Math.PI/4;var bx=x+(r*1.1)*Math.cos(a-0.2);var by=y+(r*1.1)*Math.sin(a-0.2);var cx=x+(r*1.1)*Math.cos(a+0.2);var cy=y+(r*1.1)*Math.sin(a+0.2);var tx=x+(r*1.2)*Math.cos(a-0.2);var ty=y+(r*1.2)*Math.sin(a-0.2);var tcx=x+(r*1.25)*Math.cos(a+0.28);var tcy=y+(r*1.25)*Math.sin(a+0.28);cont.beginPath();cont.fillStyle=getStyleColor (backgroundColor);cont.arc (bx, by, br, 0, Math.PI*2);cont.fill();cont.arc (cx, cy, br, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (color);cont.arc (bx, by, br*0.9, 0, Math.PI*2);cont.fill();cont.fillStyle=getStyleColor (fontColor);cont.textBaseline='middle';cont.textAlign='center';cont.font='bold '+Math.round (br*1.2)+'px arial';cont.fillText ('G', tx, ty);cont.fillStyle=getStyleColor (diffColor);cont.font='bold '+Math.round (br*0.6)+'px arial';cont.fillText ('ON', tcx, tcy);}
cont.beginPath();cont.fillStyle=getStyleColor (getColorToneByID (this.color,4));cont.arc (x, y, r, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (backgroundColor);cont.arc (x, y, r*0.95, 0, Math.PI*2);cont.fill();cont.fillStyle=getStyleColor (diffColor);for (var i=2; i<4; i++) {cont.fillRect(x-r*0.18*i, y-r*0.25*i, r*0.36*i, r*0.05);cont.fillRect(x-r*0.18*i, y+r*0.25*i, r*0.36*i, -r*0.05);}
cont.beginPath();cont.fillStyle=getStyleColor (color);cont.arc (x, y, d, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (getColorToneByID (this.color,2));cont.arc (x, y, d, -2.8, -1.2);cont.fill();}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsCheckbox ('Automatically center', 'el_autocentering', this.autocentering);html+="<div class=\"editor_settings_group\">Additional controls:</div>";sel={0:'No',1:'Top-right',2:'Bottom-right',3:'Bottom-left',4:'Top-left'};html+=getHTMLSettingsSelect ('Centering button', 'el_centerpos', getHTMLSelectOptions (this.centerpos, sel));html+=getHTMLSettingsSelect ('G-sensor button', 'el_gsensorpos', getHTMLSelectOptions (this.gsensorpos, sel));html+=getHTMLSettingsColor  ("Buttons text color","el_textcolor", this.textcolor, 0);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_autocentering') this.autocentering=document.getElementById(id).checked?1:0;else if(id=='el_centerpos') this.centerpos=parseInt (document.getElementById(id).value);else if(id=='el_gsensorpos') this.gsensorpos=parseInt (document.getElementById(id).value);return true;}}
ControlRGB.prototype=new Control ();function ControlRGB (drawtype) {this.classname="ControlRGB";this.group=GROUP_CONTROLS;this.variabletype="rgb";this.width=20;this.height=20;this.proporcional=1;this.minwidth=10;this.minheight=10;this.name='RGB color';this.drawtype=drawtype;this.haveBackgroundcolor=true;this.img="/img/views2/rgb.png";this.GetPreferenceWidth=function (cont, w, h) {return h;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top*contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var cx=(this.left+this.width/2)*contextStep;var cy=(this.top+this.height/2)*contextStep;var r=Math.min (this.width, this.height)/2*contextStep;var c=r*0.03;var c2=c/2;var dr=r*0.25;var color3=getColorToneByID (this.color,3);var color2=getColorToneByID (this.color,2);var backgroundColor=getColorByID (this.backgroundcolor);context.lineCap="butt";cont.drawImage(rgbImage, x+c2, y+c2, w-c, h-c);cont.beginPath();cont.fillStyle="#E8FF0F";cont.arc (cx, cy, r*0.35, 0, Math.PI*2);cont.fill();cont.strokeStyle=getStyleColor (backgroundColor);cont.beginPath();cont.lineWidth=c;   
cont.arc (cx, cy, r-c2, 0, Math.PI*2);cont.stroke();cont.beginPath();cont.lineWidth=c;   
cont.arc (cx, cy, r*0.67, 0, Math.PI*2);cont.stroke();cont.beginPath();cont.lineWidth=c;   
cont.arc (cx, cy, r*0.35, 0, Math.PI*2);cont.stroke();var dvx, dvy;dvx=cx;dvy=cy+r*0.5;cont.beginPath();cont.fillStyle=getStyleColor (color3);cont.arc (dvx, dvy, dr, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (color2);cont.arc (dvx, dvy, dr, -2.8, -1.2);cont.fill();dvx=cx+r*0.68;dvy=cy-r*0.48;cont.beginPath();cont.fillStyle=getStyleColor (color3);cont.arc (dvx, dvy, dr, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (color2);cont.arc (dvx, dvy, dr, -2.8, -1.2);cont.fill();cont.textBaseline='middle';cont.textAlign='center';font=Math.round (dr*0.8);cont.font='bold '+font+'px arial';cont.fillStyle="#535353";cont.fillText ("w", cx+r*0.5, cy);cont.fillText ("g", cx, cy-r*0.5);cont.fillText ("b", cx-r*0.5, cy);}}
ControlEdit.prototype=new Control ();function ControlEdit (drawtype) {this.classname="ControlEdit";this.group=GROUP_CONTROLS;this.variabletype="edit";this.width=20;this.height=5;this.proporcional=1;this.minwidth=3;this.minheight=3;this.name='Edit field';this.length=10;this.decimals=2;this.center=0;this.datatype=0;this.background=1;this.clearbutton=1;this.buttonscolor=2;this.haveBackgroundcolor=true;this.img="/img/views2/edittext.png";this.GetPreferenceWidth=function (cont, w, h) {if(w<h) return h;return w;}
this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['length']=this.length;conf['decimals']=this.decimals;conf['center']=this.center;conf['datatype']=this.datatype;conf['background']=this.background;conf['clearbutton']=this.clearbutton;conf['buttonscolor']=this.buttonscolor;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.length!=undefined) this.length=conf.length;if(conf.decimals!=undefined) this.decimals=conf.decimals;if(conf.center!=undefined) this.center=conf.center;if(conf.datatype!=undefined) this.datatype=conf.datatype;if(conf.background!=undefined) this.background=conf.background;if(conf.clearbutton!=undefined) this.clearbutton=conf.clearbutton;if(conf.buttonscolor!=undefined) this.buttonscolor=conf.buttonscolor;if(ProjectVersion<8) this.buttonscolor=this.color;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var wt=w;var d=h*0.05;var d2=d/2;var color;if(this.color<8) color=getColorToneByID (this.color,4);else color=getColorByID (this.color);var backgroundColor=getColorByID (this.backgroundcolor);var borderColor=moveColor (backgroundColor, -0.5);context.lineCap="butt";var t="edit";if(this.datatype==1) {t="0.0";if(this.decimals==1) t="0";if(this.decimals>1) {t="0.";for (var i=0; i<this.decimals-1; i++) t=t+"0";}}
else if(this.datatype==2) t="0";if(this.background==1) {cont.fillStyle=getStyleColor (backgroundColor);cont.fillRect(x, y, w, h);}
if(this.clearbutton==1) {var buttonsColor=getColorToneByID (this.buttonscolor,3);var buttonsBorderColor=getColorToneByID (this.buttonscolor,2);wt-=h-d;var xb=x+wt;var yb=y+d;var wb=h-d*2;var hb=wb;var b=d*1;cont.fillStyle=getStyleColor (buttonsBorderColor);cont.fillRoundedRect(xb, yb, wb, hb, b*2);cont.fillStyle=getStyleColor (buttonsColor);cont.fillRoundedRect(xb+b, yb+b, wb-b*2, hb-b*2, b*2*0.95);cont.strokeStyle=getStyleColor (getBlackOrWhiteColor (buttonsColor));cont.lineWidth=d*2;context.lineCap="square";cont.beginPath();cont.moveTo (xb+wb*0.3, yb+hb*0.3);cont.lineTo (xb+wb*0.7, yb+hb*0.7);cont.moveTo (xb+wb*0.7, yb+hb*0.3);cont.lineTo (xb+wb*0.3, yb+hb*0.7);cont.stroke();}
var cw=h*0.1+d;cont.textBaseline='middle';if(this.center==0) {cont.textAlign='left';cx=x+cw;}
else if(this.center==1) {cont.textAlign='center';cx=x+wt*0.5;}
else if(this.center==2) {cont.textAlign='right';cx=x+wt-cw;}
font=Math.round (h*TEXT_FONT_SIZE);cont.font='bold '+font+'px arial';cont.fillStyle=getStyleColor (color);var dt=cont.measureText(t).width;while (cw*2+dt>wt) {if(t.length<=1) {t="";break;}
if(this.center==2) t=t.substr (1);else t=t.substr (0, t.length-1);dt=cont.measureText(t).width;}
cont.fillText (t, cx, y+h*TEXT_BASE_LINE);cont.strokeStyle=getStyleColor (borderColor);cont.lineWidth=d;context.lineCap="square";cont.beginPath();cont.moveTo(x+d2, y+d2);cont.lineTo(x+w-d2, y+d2);cont.lineTo(x+w-d2, y+h-d2);cont.lineTo(x+d2, y+h-d2);cont.lineTo(x+d2, y+d2);cont.stroke();}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsSelect ('Input type', 'el_datatype', getHTMLSelectOptions (this.datatype, {0:'String',1:'Float',2:'Integer'}));if(this.datatype==0) html+=getHTMLSettingsText   ('Length', 'el_length', this.length);else if(this.datatype==1) html+=getHTMLSettingsSelect ('Decimals', 'el_decimals', getHTMLSelectOptions (this.decimals, {0:'Not limited',1:'0',2:'1',3:'2',4:'3',5:'4',6:'5',7:'6'}));html+=getHTMLSettingsSelect ('Align', 'el_center', getHTMLSelectOptions (this.center, {0:'Left',1:'Center',2:'Right'}));html+=getHTMLSettingsCheckbox ('Show background', 'el_background', this.background);html+=getHTMLSettingsCheckbox ('Clear button', 'el_clearbutton', this.clearbutton);html+=getHTMLSettingsColor  ("Buttons color","el_buttonscolor", this.buttonscolor, 0);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_length') {var inputtext=document.getElementById(id);var length=parseInt (inputtext.value);if(isNaN (length)) {inputtext.style.background="#FFC0C0";return false;}
this.length=length;}
else if(id=='el_center') this.center=parseInt (document.getElementById(id).value);else if(id=='el_datatype') this.datatype=parseInt (document.getElementById(id).value);else if(id=='el_decimals') this.decimals=parseInt (document.getElementById(id).value);else if(id=='el_background') this.background=document.getElementById(id).checked?1:0;else if(id=='el_clearbutton') this.clearbutton=document.getElementById(id).checked?1:0;else if(id.substr(0,16)=='el_buttonscolor_') {value=id.substr(16,id.length);this.buttonscolor=parseInt (value);}
return true;}}
ControlDiode.prototype=new Control ();function ControlDiode (drawtype) {this.classname="ControlDiode";this.group=GROUP_INDICATIONS;this.variabletype="led";this.width=9;this.height=9;this.proporcional=1;this.minwidth=2;this.minheight=2;this.name='Led';this.color_red=1;this.color_green=0;this.color_blue=0;this.drawtype=drawtype;this.bordertype=0;this.haveColor=false;this.haveBackgroundcolor=false;this.img="/img/views2/diode.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['color_red']=this.color_red;conf['color_green']=this.color_green;conf['color_blue']=this.color_blue;conf['drawtype']=this.drawtype;conf['bordertype']=this.bordertype;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.color_red!=undefined) this.color_red=conf.color_red;if(conf.color_green!=undefined) this.color_green=conf.color_green;if(conf.color_blue!=undefined) this.color_blue=conf.color_blue;if(conf.drawtype!=undefined) this.drawtype=conf.drawtype;if(conf.bordertype!=undefined) this.bordertype=conf.bordertype;}
this.GetPreferenceWidth=function (cont, w, h) {if(this.drawtype==0) return h;else return w;}
this.ControlDraw=function (cont) {var borderColor="#535353";if(this.bordertype==0) borderColor= "#333333";else if(this.bordertype==2) borderColor= "#e3e3e3";var color="#535353";if(this.drawtype==0) {var x=(this.left+this.width/2)*contextStep;var y=(this.top+this.height/2)*contextStep;var r=this.width*contextStep /2;cont.beginPath();cont.fillStyle=borderColor;cont.arc (x, y, r, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=color;cont.arc (x, y, r*0.9, 0, Math.PI*2);cont.fill();}
else {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var br=Math.min (w, h);cont.fillStyle=borderColor;cont.fillRoundedRect(x, y, w, h, Math.min (w, h)*0.1);var tx=x+br*0.04; ty=y+br*0.04;var tw=w-br*0.08; th=h-br*0.08;cont.fillStyle=color;var tr=Math.min (tw, th)*0.1;cont.fillRoundedRect(tx, ty, tw, th, tr);}}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsCheckbox ('-Red', 'el_color_red', this.color_red);html+=getHTMLSettingsCheckbox ('-Green', 'el_color_green', this.color_green);html+=getHTMLSettingsCheckbox ('-Blue', 'el_color_blue', this.color_blue);html+=getHTMLSettingsSelect ('Draw type', 'el_drawtype', getHTMLSelectOptions (this.drawtype, {0:'Round',1:'Rectangular'}));html+=getHTMLSettingsSelect ('Border style', 'el_bordertype', getHTMLSelectOptions (this.bordertype, {0:'Dark',1:'None',2:'Light'}));return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_color_red') this.color_red=document.getElementById(id).checked?1:0;else if(id=='el_color_green') this.color_green=document.getElementById(id).checked?1:0;else if(id=='el_color_blue') this.color_blue=document.getElementById(id).checked?1:0;else if(id=='el_drawtype') {this.drawtype=parseInt (document.getElementById(id).value);if(this.drawtype==0) this.height=this.width;}
else if(id=='el_bordertype') this.bordertype=parseInt (document.getElementById(id).value);return true;}}
ControlLevel.prototype=new Control ();function ControlLevel (drawtype) {this.classname="ControlLevel";this.group=GROUP_INDICATIONS;this.variabletype="level";this.proporcional=1;this.minwidth=4;this.minheight=4;this.center=0;this.img="/img/views2/level"+drawtype+".png";this.const_Arc=1.28;this.const_Dial=2;this.drawtype=drawtype;this.width=7;this.height=16;this.orientation=0;this.pointercolor=ColorBlackID;if((drawtype==2)||(drawtype==4)) {this.height=10;this.width=Math.round(this.height*this.const_Arc);this.orientation=1;}
if(drawtype==3) {this.width=16;this.height=7;this.orientation=1;this.name+=" analog";}
if((drawtype==0)||(drawtype==1)||(drawtype==2)) {this.haveBackgroundcolor=true;}
var names=[
'Linear level','Linear level','Arc level','Linear division level','Arc division level'
];this.name=names[drawtype];this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['orientation']=this.orientation;conf['drawtype']=this.drawtype;conf['center']=this.center;if((this.drawtype==3)||(this.drawtype==4)) conf['pointercolor']=this.pointercolor;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.orientation!=undefined) this.orientation=conf.orientation;if(conf.drawtype!=undefined) this.drawtype=conf.drawtype;if(conf.center!=undefined) this.center=conf.center;if(conf.pointercolor!=undefined) this.pointercolor=conf.pointercolor;}
this.GetPreferenceWidth=function (cont, w, h) {if((this.drawtype==2)||(this.drawtype==4)) {if(this.orientation==1) return Math.round(h*this.const_Arc);else return Math.round(h/this.const_Arc);}
if(this.drawtype==3) {if(this.orientation==1) {if(h>w) return h;}
else {if(h<w) return h;}}
return w;}
this.ControlDraw=function (cont) {x=this.left*contextStep;y=this.top *contextStep;w=this.width*contextStep;h=this.height*contextStep;if(this.orientation==0)d=h/10;else
d=w/10;if(this.center==0) {l1=0; l2=0.3; l3=0;}
else if(this.center==1) {l1=0.5; l2=0.8; l3=0.5;}
else if(this.center==2) {l1=0.7; l2=1; l3=1;}
var backgroundColor=getColorByID (this.backgroundcolor);var diffBackgroundColor=getDifferColor (backgroundColor,0.2);var color, color3, color2;if(this.color<8) {color=getColorToneByID (this.color,4);color3=getColorToneByID (this.color,3);color2=getColorToneByID (this.color,2);}
else {color=getColorByID (this.color);color3=getColorByID (this.color);color2=moveColor (getColorByID (this.color), 0.67);}
context.lineCap="butt";if(this.drawtype==0) {cont.fillStyle=getStyleColor (backgroundColor);cont.fillRect(x, y, w, h);for (i=0; i<10; i++) {if((i+0.5>l1*10)&&(i+0.5<l2*10)) cont.fillStyle=getStyleColor (color);else cont.fillStyle=getStyleColor (diffBackgroundColor);if(this.orientation==0) cont.fillRect(x+d*0.1, y+h-d*0.1-d*i, w-d*0.2, -d*0.8);else cont.fillRect(x+d*0.1+d*i, y+d*0.1, d*0.8, h-d*0.2);}}
else if(this.drawtype==1) {cont.fillStyle=getStyleColor (backgroundColor);cont.fillRect(x, y, w, h);lx= x+d*0.1;ly= y+d*0.1;lw= w-d*0.2;lh= h-d*0.2;cont.fillStyle=getStyleColor (color);if(this.orientation==0) cont.fillRect(lx, ly+lh*(1-l2), lw, lh*(l2-l1));else cont.fillRect(lx+lw*l1, ly, lw*(l2-l1), lh);}
else if(this.drawtype==2) {var a1=55;var a2=305;var cx,cy,lw;if(this.orientation==1) {cx=x+w/2;cy=y+h*this.const_Arc/2;lw=w/5;}
else {cx=x+w*this.const_Arc/2;cy=y+h/2;a1-=90;a2-=90;lw=h/5;}
var r=lw*2;cont.strokeStyle=getStyleColor (backgroundColor);this.ControlDrawArc (cont, a1, a2, cx, cy, r, lw);a1+=1.5;a2-=1.5;cont.strokeStyle=getStyleColor (color);this.ControlDrawArc (cont, a1+(a2-a1)*l1, a1+(a2-a1)*l2, cx, cy, r, lw*0.9);}
else if(this.drawtype==3) {var pointerColor=getColorByID (this.pointercolor);cont.strokeStyle=getStyleColor (color);var ch=Math.max (w, h);var cy1, cx2, cy2, cc, d;if(this.orientation==1) {cy1= y;cx2= x+w/2;cy2= y+ch;cc=h/ch;d=w*0.02;}
else {cx1= x;cx2= x+ch;cy2= y+h/2;cc=w/ch;d=h*0.02;}
for (var i=0; i<=10; i+=0.5) {if(this.orientation==1) cx1= x+w*i/10;else cy1= y+h*(10-i)/10;if(i==Math.round (i)) {cont.lineWidth=d;this.ControlDrawPartLine (cont, cx1, cy1, cx2, cy2, 0, cc*0.8);}
else {cont.lineWidth=d/2;this.ControlDrawPartLine (cont, cx1, cy1, cx2, cy2, cc*0.3, cc*0.8);}}
cont.strokeStyle=getStyleColor (pointerColor);cont.lineWidth=d;if(this.orientation==1) cx1= x+w*l3;else cy1= y+h*(1-l3);this.ControlDrawPartLine (cont, cx1, cy1, cx2, cy2, cc*0.2, cc*0.9);cont.fillStyle=getStyleColor (color);if(this.orientation==1) cont.fillRect(x, y+h*0.9, w, h*0.1);else cont.fillRect(x+w*0.9, y, w*0.1, h);cont.fillStyle=getStyleColor (color2);if(this.orientation==1) cont.fillRect(x, y+h*0.9, w, h*0.02);else cont.fillRect(x+w*0.9, y, w*0.02, h);}
else if(this.drawtype==4) {var pointerColor=getColorByID (this.pointercolor);var a1=58;var a2=302;if(this.orientation==1) {cx=x+w/2;cy=y+h*this.const_Arc/2;r1=w/2;}
else {cx=x+w*this.const_Arc/2;cy=y+h/2;a1-=90;a2-=90;r1=h/2;}
r2=r1*0.6;r3=r1*0.9;r4=r1*0.8;d=r1*0.06;cont.strokeStyle=getStyleColor (color);for (i=0; i<=10; i+=0.5) {a=a1+(a2-a1)/10*i;if(i==Math.round (i)) {cont.lineWidth=d;r=r1;}
else {cont.lineWidth=d/2;r=r3;}
cont.beginPath();cont.moveTo(cx-r*Math.sin (a/57.32), cy+r*Math.cos (a/57.32));cont.lineTo(cx-r2*Math.sin (a/57.32), cy+r2*Math.cos (a/57.32));cont.stroke();}
a=a1+(a2-a1)*l3;cont.strokeStyle=getStyleColor (pointerColor);cont.beginPath();cont.moveTo(cx, cy);cont.lineTo(cx-r4*Math.sin (a/57.32), cy+r4*Math.cos (a/57.32));cont.stroke();r=r1*0.3;cont.beginPath();cont.fillStyle=getStyleColor (color3);cont.arc (cx, cy, r, 0, Math.PI*2);cont.fill();cont.beginPath();cont.fillStyle=getStyleColor (color2);cont.arc (cx, cy, r, -2.8, -1.2);cont.fill();}}
this.ControlDrawArc=function (cont, a1, a2, cx, cy, r, lw) {cont.lineWidth=lw;cont.beginPath();for (i=a1; i<=a2; i+=5) {rx=cx-r*Math.sin (i/57.32);ry=cy+r*Math.cos (i/57.32);if(i==a1) cont.moveTo(rx, ry);else cont.lineTo(rx, ry);}
if(i!=a2) {rx=cx-r*Math.sin (a2/57.32);ry=cy+r*Math.cos (a2/57.32);cont.lineTo(rx, ry);}
cont.stroke();}
this.ControlDrawPartLine=function (cont, x1, y1, x2, y2, p1, p2) {lx1= x1+(x2-x1)*p1;ly1= y1+(y2-y1)*p1;lx2= x1+(x2-x1)*p2;ly2= y1+(y2-y1)*p2;cont.beginPath();cont.moveTo(lx1, ly1);cont.lineTo(lx2, ly2);cont.stroke();}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsSelect ('Orientation', 'el_orientation', getHTMLSelectOptions (this.orientation, {0:'Vertical',1:'Horisontal'}));var values;if(this.orientation==0) values={0:'Bottom',1:'Middle',2:'Top'};else values={0:'Left',1:'Middle',2:'Right'};html+=getHTMLSettingsSelect ('Сenter position', 'el_center', getHTMLSelectOptions (this.center, values));if((this.drawtype==0)||(this.drawtype==1)) {html+=getHTMLSettingsSelect ('Draw type', 'el_drawtype', getHTMLSelectOptions (this.drawtype, {0:'Segment',1:'Solid'}));}
if((this.drawtype==3)||(this.drawtype==4)) html+=getHTMLSettingsColor  ("Pointer color","el_pointercolor", this.pointercolor, 0);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_orientation') {var orientation=(document.getElementById(id).value==0)?0:1;if(orientation!=this.orientation) {width=this.width;this.width=this.height;this.height=width;}
this.orientation=orientation;this.width=this.GetPreferenceWidth (context, this.width, this.height);}
else if(id=='el_center') this.center=parseInt (document.getElementById(id).value);else if(id=='el_drawtype') {this.drawtype=parseInt (document.getElementById(id).value);this.width=this.GetPreferenceWidth (context, this.width, this.height);}
else if(id.substr(0,16)=='el_pointercolor_') {value=id.substr(16,id.length);this.pointercolor=parseInt (value);}
return true;}}
ControlText.prototype=new Control ();function ControlText (drawtype) {this.classname="ControlText";this.group=GROUP_INDICATIONS;this.variabletype="text";this.width=20;this.height=5;this.proporcional=1;this.minwidth=3;this.minheight=2;this.name='Text string';this.length=10;this.center=0;this.background=1;this.haveBackgroundcolor=true;this.img="/img/views2/text2.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['length']=this.length;conf['center']=this.center;conf['background']=this.background;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.length!=undefined) this.length=conf.length;if(conf.center!=undefined) this.center=conf.center;if(conf.background!=undefined) this.background=conf.background;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var color;if(this.color<8) color=getColorToneByID (this.color,4);else color=getColorByID (this.color);var backgroundColor=getColorByID (this.backgroundcolor);var t="text";if(this.background!=0) {cont.fillStyle=getStyleColor (backgroundColor);cont.fillRect(x, y, w, h);}
cont.textBaseline='middle';var cw=h*0.1;if(this.center==0) {cont.textAlign='left';cx=x+cw;}
else if(this.center==1) {cont.textAlign='center';cx=x+w*0.5;}
else if(this.center==2) {cont.textAlign='right';cx=x+w-cw;}
font=Math.round (h*TEXT_FONT_SIZE);cont.font='bold '+font+'px arial';cont.fillStyle=getStyleColor (color);var dt=cont.measureText(t).width;while (cw*2+dt>w) {if(t.length<=1) {t="";break;}
if(this.center==2) t=t.substr (1);else t=t.substr (0, t.length-1);dt=cont.measureText(t).width;}
cont.fillText (t, cx, y+h*TEXT_BASE_LINE);}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsText   ('Length', 'el_length', this.length);html+=getHTMLSettingsSelect ('Align', 'el_center', getHTMLSelectOptions (this.center, {0:'Left',1:'Center',2:'Right'}));html+=getHTMLSettingsCheckbox ('Show background', 'el_background', this.background);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_length') {var inputtext=document.getElementById(id);var length=parseInt (inputtext.value);var err=false;if(isNaN (length)) err=true;else if(length>254) err=true;if(err) {inputtext.style.background="#FFC0C0";return false;}
this.length=length;}
if(id=='el_center') this.center=parseInt (document.getElementById(id).value);if(id=='el_background') this.background=document.getElementById(id).checked?1:0;return true;}}
ControlOnlineGraph.prototype=new Control ();function ControlOnlineGraph (drawtype) {this.classname="ControlOnlineGraph";this.group=GROUP_INDICATIONS;this.variabletype="onlineGraph";this.width=20;this.height=20;this.proporcional=1;this.minwidth=20;this.minheight=12;this.name='Online graph';this.varscount=1;this.showlegend=0;this.showvalues=1;this.backgroundcolor=8;this.haveBackgroundcolor=true;this.haveColor=false;this.img="/img/views2/onlinegraph.png";this.varscolors=[36,135,94,204,233,163,177,78,246,105];this.varslegends=["","","","","","","","","",""];for (var j=0; j<10; j++) this.varslegends[j]="Variable "+(j+1);this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['showlegend']=this.showlegend;conf['showvalues']=this.showvalues;conf['varscount']=this.varscount;var varscolors=[];var varslegends=[];for (var j=0; j<this.varscount; j++) {varscolors.push(this.varscolors[j]);varslegends.push(this.varslegends[j]);}
conf['varscolors']=varscolors;conf['varslegends']=varslegends;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.showlegend!=undefined) this.showlegend=conf.showlegend;if(conf.showvalues!=undefined) this.showvalues=conf.showvalues;if(conf.varscount!=undefined) this.varscount=conf.varscount;if(conf.varscolors!=undefined) {if(typeof conf.varscolors=="object") {for (var j=0; j<this.varscount; j++) {if(conf.varscolors[j]!=undefined) this.varscolors[j]=conf.varscolors[j];}}}
if(conf.varslegends!=undefined) {if(typeof conf.varslegends=="object") {for (var j=0; j<this.varscount; j++) {if(conf.varslegends[j]!=undefined) this.varslegends[j]=conf.varslegends[j];}}}}
this.ControlDraw=function (cont) {var fontSize=2.8;var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var fs=fontSize*contextStep;var padXleft=contextStep*fontSize/4;var padXright=padXleft;if(this.showvalues!=0) {padXright=contextStep*fontSize*2.5;}
var padYtop=contextStep*fontSize/2;var padYbottom=contextStep*fontSize*1.3;cont.textBaseline='middle';cont.textAlign='left';cont.font='normal '+Math.round (fs)+'px arial';var mainColor=getColorByID (this.backgroundcolor);var linesColor=getDifferColor (mainColor, 0.2);var textColor=getDifferColor (mainColor, 0.5);cont.fillStyle=getStyleColor (mainColor);cont.fillRect(x, y, w, h);if(this.showlegend) {var maxw=0;for (j=0; j<this.varscount; j++) {var curw=cont.measureText(this.varslegends[j]).width+fs*2.5;if(curw>maxw) maxw=curw;}
var cols=Math.floor (w/maxw);if(cols<=1) cols=1;if(cols>this.varscount) cols=this.varscount;var tx=0;var ty=0;for (j=0; j<this.varscount; j++) {var c=getColorByID (this.varscolors[j]);cont.fillStyle=getStyleColor (c);cont.fillRect(tx*w/cols+x+fs, ty*fs+y+fs*0.6, fs, fs/4);cont.fillText (this.varslegends[j], tx*w/cols+x+fs*2.5, ty*fs+y+fs*0.7);tx++;if((tx==cols)&&(j<this.varscount-1)) {tx=0;ty++;}}
padYtop+= (ty+1)*fs+fs*0.3;}
var gx=x+padXleft;var gy=y+padYtop;var gw=w-padXleft-padXright;var gh=h-padYtop-padYbottom;var linesX=Math.round (this.width/10);var linesY=Math.round (this.height/20)*2;var i, j, vx, vy, txt;cont.strokeStyle=getStyleColor (linesColor);cont.fillStyle=getStyleColor (textColor);cont.textAlign='left';cont.lineWidth=1;cont.beginPath();for (i=0; i<=linesY; i++) {vy= gy+gh/linesY*i;v=i/linesY*2 -1;txt=Math.round (v*100)/100;var txtWidth=cont.measureText(txt).width;cont.moveTo(gx, vy);cont.lineTo(gx+fs*0.3, vy);cont.moveTo(gx+txtWidth+fs*0.5, vy);cont.lineTo(gx+gw, vy);cont.fillText (txt, gx+fs*0.4, vy);}
cont.textAlign='center';var m=30;for (i=0; i<=linesX; i++) {vx=gx+gw/linesX*i;cont.moveTo(vx, gy);cont.lineTo(vx, gy+gh);if((i%2)&&((i<linesX)||this.showvalues))cont.fillText ("10:21:"+m, vx, y+h-padYbottom*0.4);m+=1;}
cont.stroke();cont.textAlign='left';cont.lineWidth=1;var points=20;for (j=1; j<=this.varscount; j++) {var c=getColorByID (this.varscolors[j-1]);cont.strokeStyle=getStyleColor (c);cont.fillStyle=getStyleColor (c);cont.beginPath();for (i=0; i<=points; i++) {vx=gx+gw/points*i;v=Math.sin (Math.PI*2/points*i+0.6*j-1.3);vy=-v*gh/2+gy+gh/2;if(i==0) cont.moveTo(vx, vy);else cont.lineTo(vx, vy);}
cont.stroke();if(this.showvalues!=0) {txt=Math.round (v*100)/100;cont.fillText (txt, vx+fs*0.1, vy);}}}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);sel={};for (var i=1; i<=10; i++) sel[i]=''+i;html+=getHTMLSettingsCheckbox ('Show legend', 'el_showlegend', this.showlegend);html+=getHTMLSettingsCheckbox ('Show values', 'el_showvalues', this.showvalues);html+=getHTMLSettingsSelect ('Variables count', 'el_varscount', getHTMLSelectOptions (this.varscount, sel));html+="<div class=\"editor_settings_group\" style=\"width:100%;\">Data:</div>";for (var j=0; j<this.varscount; j++) {html+="<div class=\"editor_settings_item\" style=\"width:100%;padding-top:8px;\">Data "+(j+1)+":</div>";if(this.showlegend) {html+=getHTMLSettingsText   ('', "el_varslegends_"+j, this.varslegends[j]);}
html+=getHTMLSettingsColor  ("","el_varscolors_"+j, this.varscolors[j], 0);}
return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_varscount') {this.varscount=parseInt (document.getElementById(id).value);if(isNaN(this.varscount)) this.varscount=1;if(this.varscount<1) this.varscount=1;if(this.varscount>10) this.varscount=10;}
else if(id.substr(0,14)=='el_varscolors_') {var i=parseInt (id.substr(14,1));var value=parseInt (id.substr(16,id.length));this.varscolors[i]=value;}
else if(id.substr(0,15)=='el_varslegends_') {var i=parseInt (id.substr(15,1));this.varslegends[i]=document.getElementById(id).value;}
else if(id=='el_showlegend') this.showlegend=document.getElementById(id).checked?1:0;else if(id=='el_showvalues') this.showvalues=document.getElementById(id).checked?1:0;return true;}}
ControlLabel.prototype=new Control ();function ControlLabel (drawtype) {this.classname="ControlLabel";this.group=GROUP_DECORATIONS;this.variabletype="";this.width=18;this.height=6;this.minwidth=3;this.minheight=2;this.color=17;this.name='Label';this.text="Label";this.img="/img/views2/label.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['text']=this.text;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.text!=undefined) this.text=conf.text;}
this.ControlDraw=function (cont) {x=this.left*contextStep;y=this.top *contextStep;w=this.width*contextStep;h=this.height*contextStep;cont.textBaseline='middle';cont.textAlign='left';font=Math.round (h);cont.font='bold '+font+'px arial';cont.fillStyle=getStyleColor (getColorByID (this.color));cont.fillText (this.text, x, y+h/2);}
this.GetPreferenceWidth=function (cont, w, h) {font=Math.round (h*contextStep);cont.font='bold '+font+'px arial';return Math.round (cont.measureText(this.text).width/contextStep);}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsText   ('Text of label', 'el_text', this.text);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_text') {this.text=document.getElementById(id).value;this.width=this.GetPreferenceWidth (context, this.width, this.height);}
return true;}}
ControlPanel.prototype=new Control ();function ControlPanel (drawtype) {this.classname="ControlPanel";this.group=GROUP_DECORATIONS;this.variabletype="";this.width=20;this.height=20;this.minwidth=1;this.minheight=1;this.color=17;this.name='Panel';this.drawtype=drawtype;this.img="/img/views2/panel.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['drawtype']=this.drawtype;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.drawtype!=undefined) this.drawtype=conf.drawtype;if(conf.color!=undefined) this.backgroundcolor=conf.color;}
this.ControlDraw=function (cont) {x=this.left*contextStep;y=this.top *contextStep;w=this.width*contextStep;h=this.height*contextStep;var color=getColorByID (this.color);cont.fillStyle=getStyleColor (color);cont.fillRect(x, y, w, h);cont.lineWidth=1;var r=(color>>16) & 0xff;var g=(color>>8) & 0xff;var b=color & 0xff;color_d1=moveColor (color,-0.7);color_d2=moveColor (color,-0.4);color_l1=moveColor (color,0.7);color_l2=moveColor (color,0.4);context.lineCap="butt";if(this.drawtype==0) {cont.strokeStyle=getStyleColor (color_d2);cont.strokeRect(x, y, w, h);}
else {if(this.drawtype==1) {c1=color_l2;c2=color_l1;c3=color_d1;c4=color_d2;}
else {c1=color_d2;c2=color_d1;c3=color_l1;c4=color_l2;}
cont.strokeStyle=getStyleColor (c1);cont.strokeRect(x+1, y+1, w-2, h-2);cont.strokeStyle=getStyleColor (c2);cont.strokeRect(x, y, w, h);cont.strokeStyle=getStyleColor (c3);cont.beginPath();cont.moveTo(x+w-1, y+1);cont.lineTo(x+w-1, y+h-1);cont.lineTo(x+1, y+h-1);cont.stroke();cont.strokeStyle=getStyleColor (c4);cont.beginPath();cont.moveTo(x+w, y);cont.lineTo(x+w, y+h);cont.lineTo(x, y+h);cont.stroke();}}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsSelect ('Bevel cut', 'el_drawtype', getHTMLSelectOptions (this.drawtype, {0:'Linear',1:'Raised',2:'Lowered'}));return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_drawtype') this.drawtype=parseInt (document.getElementById(id).value);return true;}}
ControlTerminal.prototype=new Control ();function ControlTerminal (drawtype) {this.classname="ControlTerminal";this.group=GROUP_INDICATIONS;this.variabletype="terminal";this.width=20;this.height=15;this.name='Terminal';this.drawtype=drawtype;this.haveBackgroundcolor=true;this.backgroundcolor=ColorBlackID;this.color=ColorWhiteID;this.fontsize=6;this.img="/img/views2/terminal.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['fontsize']=this.fontsize;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.fontsize!=undefined) this.fontsize=conf.fontsize;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var backgroundcolor=getColorByID (this.backgroundcolor);var color=getColorByID (this.color);cont.fillStyle=getStyleColor (backgroundcolor);cont.fillRect(x, y, w, h);var font=Math.round (contextStep/2*this.fontsize);cont.font='normal '+font+'px arial';cont.fillStyle=getStyleColor (color);cont.textBaseline='middle';cont.textAlign='left';cont.fillText (">", x+font*0.3, y+font*0.7);}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsText   ('Font size', 'el_fontsize', this.fontsize);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_fontsize') {var inputtext=document.getElementById(id);var fontsize=parseInt (inputtext.value);var err=false;if(isNaN (fontsize)) err=true;else if(fontsize>20) err=true;else if(fontsize<1) err=true;if(err) {inputtext.style.background="#FFC0C0";return false;}
this.fontsize=fontsize;}
return true;}}
ControlPage.prototype=new Control ();function ControlPage (drawtype) {this.classname=CLASSNAME_PAGE;this.group=GROUP_DECORATIONS;this.variabletype="";this.width=20;this.height=7;this.name='Page';this.text="Page";this.drawtype=drawtype;this.bordertype=0;this.img="/img/views2/page.png";this.main=0;this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['text']=this.text;conf['textcolor']=this.textcolor;conf['main']=this.main;conf['bordertype']=this.bordertype;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.text!=undefined) this.text=conf.text;if(conf.textcolor!=undefined) this.textcolor=conf.textcolor;if(conf.main!=undefined) this.main=conf.main;if(conf.bordertype!=undefined) this.bordertype=conf.bordertype;}
this.GetPreferenceHeight=function (cont, w, h) {if(h>w) return w;else return h;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;var cy=y+h/2;var r=h/2*0.97;var color=getColorToneByID (this.color,4);if(viewlist!=undefined)if(page.getViewPage()==this.page) color=getColorToneByID (this.color,3);var borderColor=color;if(this.bordertype==0) borderColor=getColorToneByID (this.color,1);else if(this.bordertype==2) borderColor=getColorToneByID (this.color,2);cont.fillStyle=getStyleColor(borderColor);cont.fillRoundedRect(x, y, w, h, r);var t=h*0.05;var t2=t*2;cont.fillStyle=getStyleColor(color);cont.fillRoundedRect(x+t, y+t, w-t2, h-t2, r-t);cont.fillStyle=getStyleColor (getColorByID (this.textcolor));cont.textBaseline='middle';cont.textAlign='center';var font=Math.round (h*0.7);cont.font='bold '+font+'px arial';var text=this.text;cw=h*0.2;var dw=cont.measureText(text).width;f=0;while (dw+cw>w) {text=text.substring(0, text.length-1);dw=cont.measureText(text).width;}
cont.fillText (text, x+w/2, y+h/2);}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsText   ('Page name', 'el_text', this.text);html+=getHTMLSettingsColor  ("","el_textcolor", this.textcolor, 0);html+=getHTMLSettingsSelect ('Border style', 'el_bordertype', getHTMLSelectOptions (this.bordertype, {0:'Dark',1:'None',2:'Light'}));html+=getHTMLSettingsCheckbox ('Main page', 'el_main', this.main);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_text') this.text=document.getElementById(id).value;else if(id=='el_main') {if(document.getElementById(id).checked) {for (var i in viewlist.list) {curview=viewlist.list[i];if(curview.classname==CLASSNAME_PAGE) curview.main=0;}
this.main=1;}}
else if(id=='el_bordertype') this.bordertype=parseInt (document.getElementById(id).value);return true;}
this.createNew=function () {if(!Object.getPrototypeOf(this).createNew.apply(this));var pages=viewlist.getPages ();if(pages!=null) {for (var i=1; i<127; i++) {if(pages[i]==undefined) {this.page=i;this.main=0;break;}}}
else {this.page=1;this.main=1;}}}
ControlSound.prototype=new Control ();function ControlSound (drawtype) {this.classname="ControlSound";this.group=GROUP_INDICATIONS;this.variabletype="sound";this.width=10;this.height=10;this.name='Sound';this.drawtype=drawtype;this.color=1;this.hide=0;this.img="/img/views2/sound.png";this.getConfiguration=function () {var conf=Object.getPrototypeOf(this).getConfiguration.apply(this);conf['hide']=this.hide;return conf;}
this.setConfiguration=function (conf) {Object.getPrototypeOf(this).setConfiguration.apply(this, [conf]);if(conf.hide!=undefined) this.hide=conf.hide;}
this.GetPreferenceWidth=function (cont, w, h) {if(this.orientation==0) return h;else return w;}
this.GetPreferenceHeight=function (cont, w, h) {if(this.orientation!=0) return w;else return h;}
this.ControlDraw=function (cont) {var x=this.left*contextStep;var y=this.top *contextStep;var w=this.width*contextStep;var h=this.height*contextStep;if(this.hide!=0) context.globalAlpha=0.5;var color=getColorByID (this.color);cont.fillStyle=getStyleColor (color);cont.beginPath();cont.moveTo(x+w*0.3, y+h*0.3);cont.lineTo(x+w*0.5, y+h*0.1);cont.lineTo(x+w*0.5, y+h*0.9);cont.lineTo(x+w*0.3, y+h*0.7);cont.lineTo(x, y+h*0.7);cont.lineTo(x, y+h*0.3);cont.closePath();cont.fill();cont.lineWidth=w*0.05;cont.lineJoin="round";cont.strokeStyle=getStyleColor (color);for (var i=0; i<3; i++) {cont.beginPath();cont.arc(x+w*0.5, y+h*0.5, w*(i*0.13+0.2), -0.35*Math.PI, 0.35*Math.PI, false);cont.stroke();}
cont.globalAlpha=1;}
this.GetHTMLSettings=function () {var html=Object.getPrototypeOf(this).GetHTMLSettings.apply(this);html+=getHTMLSettingsCheckbox ('-Hide on screen', 'el_hide', this.hide);return html;}
this.SetSetting=function (id) {if(!Object.getPrototypeOf(this).SetSetting.apply(this, [id])) return false;if(id=='el_hide') this.hide=document.getElementById(id).checked?1:0;return true;}}
var MARKER_SIZE=4;var FONT_SIZE=12;function ViewList () {this.list=[];this.select=null;this.selectarray=null;this.settingsSelect=null;this.mousedown=0;this.mousedown_x=0;this.mousedown_y=0;this.mousemove_dx=0;this.mousemove_dy=0;this.clipboardarray=new Array ();this.clipboardindex=0;this.clipboard_x=0;this.clipboard_y=0;this.loadOrientation=function () {for (var i in this.list)this.list[i].loadOrientation ();ClearHistory ();}
this.ViewListAdd=function (view) {if(view.variabletype!="") {if(view.variable=="") {k=1; f=0;while (f==0) {f=1;variable=view.variabletype+"_"+k;for (var i in this.list) {if(this.list[i].variable==variable) {f=0;k++;break;}}}
view.variable=variable;}}
this.list.push(view);this.ViewListDraw ();}
this.ViewListDelete=function (view) {if(view.classname==CLASSNAME_PAGE) {var pg=view.page;for (var i in this.list) {curview=this.list[i];if(curview.page==pg) curview.page=0;}}
this.list.splice (this.list.indexOf (view) ,1);this.ViewListDraw ();page.updateSettings ();}
this.ViewListClear=function () {this.list=[];this.UnSelectAll ();ProjectName="New project";ProjectVersion=EditorVersion;NewProject=1;UnsavedProject=0;this.ViewListDraw ();page.updateSettings ();}
this.getSelectArray=function () {if(this.select) return [this.select];if(this.selectarray) return this.selectarray;return null;}
this.ViewAddClipboard=function(view) {this.clipboardindex++;this.clipboardarray[this.clipboardindex]=view;}
this.ViewClearClipboard=function() {this.clipboardarray.splice (0);this.clipboardindex=0;}
this.visibleView=function (view) {var cp=page.getViewPage();if((view.page==cp)||(view.classname==CLASSNAME_PAGE)||(view.page==0)||(cp==0)) return true;return false;}
this.ViewListDraw=function () {context.fillStyle=getStyleColor (getColorByID(settings.getBackgroundColor(),1));context.fillRect(0, 0, contextWidth, contextHeight);for (var i in this.list) {curview=this.list[i];if(this.visibleView (curview)) curview.ControlDraw (context);}
if(this.select) this.select.ControlDrawSelect (context,0);if(this.selectarray) {for (var i in this.selectarray) {this.selectarray[i].ControlDrawSelect (context,1);}}
if(this.list.length==0) {context.textBaseline='middle';context.textAlign='center';context.font='bold 20px arial';context.fillStyle="#FFFFFF";context.fillText ("Drag-and-drop here", contextWidth/2, contextHeight/2-20);context.fillText ("the controls", contextWidth/2, contextHeight/2+20);}
if(this.mousedown==7) {context.beginPath();if(settings.getBackgroundColor()<8) context.strokeStyle="#ffffff";else context.strokeStyle="#000000";context.lineWidth=1;context.strokeRect(this.mousedown_x,this.mousedown_y,this.mousemove_dx,this.mousemove_dy);context.closePath();context.stroke();}}
this.UnSelectAll=function () {this.select=null;this.selectarray=null;page.updateSettings ();}
this.ViewListOnMouseDown=function (event) {var e=event||window.event;Actions_Close ();var move=0;var x, y;canvpos=getElementPosition (canv);if(e.type=="mousedown") {if(e.which==1) move=1;else if(e.which==3) move=0;else return false;x=e.pageX-canvpos.left;y=e.pageY-canvpos.top;}
else if(e.type=="touchstart") {if(this.select!=null) move=2;var touch=event.targetTouches[0];x=touch.pageX-canvpos.left;y=touch.pageY-canvpos.top;}
else return true;this.mousedown=0;if(this.select) {var md=this.select.ControlSelectResize (x, y);if(md>0) {this.mousedown=md;this.select.SavePosition ();}}
if(this.mousedown==0) {if(this.selectarray) {for (var i in this.selectarray) {if(this.selectarray[i].ControlSelect (x, y)>0) {this.mousedown=6;}
this.selectarray[i].SavePosition();}}}
if(this.mousedown==0) {var select=null;for (var i in this.list) {if(this.visibleView (this.list[i])) {if(this.list[i].ControlSelect (x, y)>0) {this.mousedown=1;select=this.list[i];if((move==2)&&(this.select!=select)) move=0;}}}
if(this.mousedown==1) {page.updateSettings ();if((this.select==null)&&(this.selectarray==null)) {this.select=select;this.select.SavePosition ();}
else if(!e.shiftKey) {this.UnSelectAll ();this.select=select;this.select.SavePosition ();}
else {if(this.selectarray==null)  {this.selectarray=[];this.selectarray[0]=this.select;this.select=null;}
this.selectarray[this.selectarray.length]=select;}
if(select.classname==CLASSNAME_PAGE) page.setViewPage (select.page);page.updateSettings ();}}
if(this.mousedown==0) {if(move==1) {this.mousedown=7;}
else {this.UnSelectAll ();}}
if(move==0) this.mousedown=0;this.mousedown_x=x;this.mousedown_y=y;this.mousemove_dx=0;this.mousemove_dy=0;this.ViewListDraw ();return true;}
this.Move=function (eventType) {if(this.mousedown==7) {this.ViewListDraw ();}
else if(this.mousedown==6)  {dx=this.mousemove_dx;dy=this.mousemove_dy;for (var i in this.selectarray) {selview=this.selectarray[i];cx=(selview.select_x+dx)/contextStep+selview.width/2;cy=(selview.select_y+dy)/contextStep+selview.height/2;if(cx<0) dx-=cx*contextStep;if(cx>MAX_X) dx-=(cx-MAX_X)*contextStep;if(cy<0) dy-=cy*contextStep;if(cy>MAX_Y) dy-=(cy-MAX_Y)*contextStep;}
var unsaved=false;for (var i in this.selectarray) {var selview=this.selectarray[i];var left=Math.round ((selview.select_x+dx)/contextStep);var top=Math.round ((selview.select_y+dy)/contextStep);if((selview.left!=left)||(selview.top!=top)) {selview.left=left;selview.top=top;selview.saveOrientation ();unsaved=true;}}
if(unsaved) Unsaved (1);if(eventType=='up') Unsaved (2);this.ViewListDraw ();}
else if(this.select) {var selview=this.select;var dx=this.mousemove_dx;var dy=this.mousemove_dy;if(this.mousedown==1) {var left=Math.round ((selview.select_x+dx)/contextStep);var top=Math.round ((selview.select_y+dy)/contextStep);if((left>=-selview.width/2)&&(left<=MAX_X-selview.width/2)&&(top>=-selview.height/2)&&(top<=MAX_Y-selview.height/2)) {if((selview.left!=left)||(selview.top!=top)) {selview.left=left;selview.top=top;selview.saveOrientation ();Unsaved (1);this.ViewListDraw ();}}
if(eventType=='up') Unsaved (2);}
else if(this.mousedown!=0) {if(this.mousedown==2) {kx=-1; ky=-1;}
else if(this.mousedown==3) {kx=1; ky=-1;}
else if(this.mousedown==4) {kx=1; ky=1;}
else if(this.mousedown==5) {kx=-1; ky=1;}
var width=Math.round ((selview.select_w+dx*kx)/contextStep);var height=Math.round ((selview.select_h+dy*ky)/contextStep);var left=selview.left;var top=selview.top;if(height <= selview.minheight) {dy=(selview.minheight*contextStep-selview.select_h)*ky;height=selview.minheight;}
if(width <= selview.minwidth) {dx=(selview.minwidth*contextStep-selview.select_w)*kx;width=selview.minwidth;}
var w=Math.round ((selview.select_w+dx*kx)/contextStep);var h=Math.round ((selview.select_h+dy*ky)/contextStep);if(selview.GetPreferenceHeight!=null) {height=selview.GetPreferenceHeight (context, w, h);dy=(height*contextStep-selview.select_h)*ky;}
if(selview.GetPreferenceWidth!=null) {width=selview.GetPreferenceWidth (context, w, h);dx=(width*contextStep-selview.select_w)*kx;}
if(kx<0) left=selview.left+selview.width-width;if(ky<0) top=selview.top+selview.height-height;if((left>=-width/2)&&(left<=MAX_X-width/2)&&(top>=-height/2)&&(top<=MAX_Y-height/2)) {if((selview.width!=width)||(selview.height!=height)||(selview.left!=left)||(selview.top!=top)) {selview.width=width;selview.height=height;selview.left=left;selview.top=top;selview.saveOrientation ();Unsaved (1);this.ViewListDraw ();}}
if(eventType=='up') Unsaved (2);}}}
this.ViewListOnMouseMove=function (event) {var e=event||window.event;canvpos=getElementPosition (canv);if(e.type=="mousemove") {x=e.pageX-canvpos.left;y=e.pageY-canvpos.top;}
else if(e.type=="touchmove") {var touch=event.targetTouches[0];x=touch.pageX-canvpos.left;y=touch.pageY-canvpos.top;}
else return;this.mousemove_dx=x-this.mousedown_x;this.mousemove_dy=y-this.mousedown_y;this.Move ('move');return false;}
this.ViewListOnMouseUp=function (event) {var e=event||window.event;f=0;if(e.type=="mouseup") {if(e.which==1) f=1;}
else if(e.type=="touchend") f=1;if(f==1) {this.Move ('up');if(this.mousedown==7) {this.UnSelectAll ();x=this.mousedown_x;y=this.mousedown_y;dx=this.mousemove_dx;dy=this.mousemove_dy;mode=1;if(dx<0) {x+=dx;dx=-dx;mode=-1;}
if(dy<0) {y+=dy;dy=-dy;mode=-1;}
this.selectarray=[];var k=0;for (var i in this.list) {if(this.visibleView (this.list[i])) {if(this.list[i].ControlSelectGroup (x, y, dx, dy, mode)>0) {this.selectarray[k++]=this.list[i];}}}
if(k==0) this.selectarray=null;this.mousedown=0;this.ViewListDraw ();page.updateSettings ();}
else {this.mousedown=0;}}
else return false;}
this.ViewListOnKeyDown=function (event) {var keyCode=event.keyCode;var tagName=document.activeElement.tagName;if((tagName)&&(tagName!="INPUT")) {if((keyCode>=37)&&(keyCode<=40)) {var dx=0;var dy=0;switch (keyCode) {case 37: dx=-1; dy=0; break;case 38: dx=0; dy=-1; break;case 39: dx=1; dy=0; break;case 40: dx=0; dy=1; break;}
var selview, left, top;if(this.select) {selview=this.select;left=selview.left+dx;top=selview.top+dy;if((left+selview.width>0)&&(left<MAX_X)&&(top+selview.height>0)&&(top<MAX_Y)) {selview.left=left;selview.top=top;selview.saveOrientation ();Unsaved ();this.ViewListDraw ();return false;}}
else if(this.selectarray) {var f=true;for (var i in this.selectarray) {selview=this.selectarray[i];left=selview.left+dx;top=selview.top+dy;if((left+selview.width<=0)||(left>=MAX_X)||(top+selview.height<=0)||(top>=MAX_Y)) f=false;}
if(f) {for (var i in this.selectarray) {selview=this.selectarray[i];selview.left+=dx;selview.top+=dy;selview.saveOrientation ();}
Unsaved ();this.ViewListDraw ();return false;}}}
else if((keyCode==65)&&(event.ctrlKey)) {this.onclickContextMenuSelectAll ();return false;}
else if((keyCode==67)&&(event.ctrlKey)) {this.onclickContextMenuCopy ();return false;}
else if((keyCode==86)&&(event.ctrlKey)) {this.onclickContextMenuPsate ();return false;}
else if((keyCode==88)&&(event.ctrlKey)) {this.onclickContextMenuCut ();return false;}
else if(keyCode==46) {this.onclickContextMenuDelete ();return false;}
else if((keyCode==90)&&(event.ctrlKey)) {this.onclickContextMenuUndo ();return false;}
else if((keyCode==89)&&(event.ctrlKey)) {this.onclickContextMenuRedo ();return false;}}
return true;}
/*
настройка элемента
*/
this.getHtmlElementSetting=function () {if((!this.select)&&(!this.selectarray)) return '';this.settingsSelect=null;var html='';var haveColor=false;var selectColor=-1;var haveBackgroundcolor=false;var selectBackgroundcolor=-1;var showPageSelect=false;var valPageSelect='-';if(this.select) {haveColor=this.select.haveColor;haveBackgroundcolor=this.select.haveBackgroundcolor;selectColor=this.select.color;selectBackgroundcolor=this.select.backgroundcolor;if(this.select.classname!=CLASSNAME_PAGE) {showPageSelect=true;valPageSelect=this.select.page;}}
else {for (var i in this.selectarray) {selview=this.selectarray[i];if(selview.haveColor) {haveColor=true;if(selectColor==-1) selectColor=selview.color;else if((selectColor>0)&&(selectColor!=selview.color)) selectColor=-2;}
if(selview.haveBackgroundcolor) {haveBackgroundcolor=true;if(selectBackgroundcolor==-1) selectBackgroundcolor=selview.backgroundcolor;else if((selectBackgroundcolor>0)&&(selectBackgroundcolor!=selview.backgroundcolor)) selectBackgroundcolor=-2;}
var fpage=true;if(selview.classname!=CLASSNAME_PAGE) {showPageSelect=true;if(valPageSelect=='-') valPageSelect=selview.page;else if(valPageSelect!=selview.page) fpage=false;}
if(!fpage) valPageSelect='-';}}
if(haveColor) {html+=getHTMLSettingsColor ("Color","el_color", selectColor, 0);}
if(haveBackgroundcolor) {html+=getHTMLSettingsColor ("Background color","el_backgroundcolor", selectBackgroundcolor, 1);}
if(this.select) {this.settingsSelect=this.select;html+=this.select.GetHTMLSettings ();}
if(showPageSelect) {var pages=this.getPages ();if(pages!=null) {if(valPageSelect=='-') pages['-']=' ';html+=getHTMLSettingsSelect ('Page', 'el_page', getHTMLSelectOptions (valPageSelect, pages));}}
return html;}
this.onchangeSetting=function (id) {var update=false;var selectArray=this.getSelectArray ();for (var i in selectArray) {if(selectArray[i].SetSetting (id)) update=true;}
return update;}
/*
контекстное меню
*/
this.oncontextmenu =function (event) {var e=event||window.event;elContextMenu.innerHTML='';var canvpos=getElementPosition (canv);var x=e.pageX-canvpos.left;var y=e.pageY-canvpos.top;this.clipboard_x=x/contextStep;this.clipboard_y=y/contextStep;var isselected= ((this.select)||(this.selectarray))?1:0;Windows_AddContextMenuElement (elContextMenu, "Undo (Ctrl+Z)", "return viewlist.onclickContextMenuUndo ();", historyPosition>0);Windows_AddContextMenuElement (elContextMenu, "Redo (Ctrl+Y)", "return viewlist.onclickContextMenuRedo ();", historyPosition<historyPositionMax);Windows_AddContextMenuDivider (elContextMenu);Windows_AddContextMenuElement (elContextMenu, "Cut (Ctrl+X)", "return viewlist.onclickContextMenuCut ();", isselected);Windows_AddContextMenuElement (elContextMenu, "Copy (Ctrl+C)", "return viewlist.onclickContextMenuCopy ();", isselected);Windows_AddContextMenuElement (elContextMenu, "Paste (Ctrl+V)", "return viewlist.onclickContextMenuPsate ();", this.clipboardindex>0);Windows_AddContextMenuElement (elContextMenu, "Delete (Del)", "return viewlist.onclickContextMenuDelete ();", isselected);Windows_AddContextMenuDivider (elContextMenu);Windows_AddContextMenuElement (elContextMenu, "Select all (Ctrl+A)", "return viewlist.onclickContextMenuSelectAll ();", this.list.length>0);Windows_AddContextMenuDivider (elContextMenu);Windows_AddContextMenuElement (elContextMenu, "To front", "return viewlist.moveZposition (2);", isselected);Windows_AddContextMenuElement (elContextMenu, "Forward one", "return viewlist.moveZposition (1);", isselected);Windows_AddContextMenuElement (elContextMenu, "Back one", "return viewlist.moveZposition (-1);", isselected);Windows_AddContextMenuElement (elContextMenu, "To back", "return viewlist.moveZposition (-2);", isselected);y=y+canvpos.top;x=x+canvpos.left;if(y+350 > elContent.clientHeight) y=elContent.clientHeight-350;Actions_Open ("div_contextmenu", x, y, 0);elContextMenu.onmousedown=function (e) {e.bodynoclose=1;};return false;}
this.onclickContextMenuCut=function () {this.onclickContextMenuCopy ();this.onclickContextMenuDelete ();return false;}
this.onclickContextMenuCopy=function () {Actions_Close ();this.ViewClearClipboard ();if(this.select) {selectview=clone(this.select);selectview.left-=this.clipboard_x;selectview.top-=this.clipboard_y;this.ViewAddClipboard (selectview);}
if(this.selectarray) {for (var i in this.selectarray) {selectview=clone(this.selectarray[i]);selectview.left-=this.clipboard_x;selectview.top-=this.clipboard_y;this.ViewAddClipboard (selectview);}}
return false;}
this.onclickContextMenuPsate=function () {Actions_Close ();if((this.select)||(this.selectarray)) {if(this.clipboardindex>0) {if(this.select) {selectview=this.select;for (var i in this.clipboardarray) {newview=clone (this.clipboardarray[i]);newview.left=selectview.left;newview.top=selectview.top;this.ViewListAdd (newview);}
viewlist.ViewListDelete (this.select);Unsaved ();this.UnSelectAll ();this.ViewListDraw ();page.updateSettings ();}
if(this.selectarray) {this.onclickContextMenuDelete ();this.onclickContextMenuPsate ();}}}
else {this.selectarray=[];var k=0;var dx=this.clipboard_x;var dy=this.clipboard_y;for (var i in this.clipboardarray) {newview=this.clipboardarray[i];cx=Math.round ((newview.left+dx)+newview.width/2);cy=Math.round ((newview.top+dy)+newview.height/2);if(cx<0) dx-=cx;if(cx>100) dx-=(cx-100);if(cy<0) dy-=cy;if(cy>65) dy-=(cy-65);}
for (var i in this.clipboardarray) {newview=clone (this.clipboardarray[i]);newview.left=dx+newview.left;newview.top=dy+newview.top;newview.createNew ();this.ViewListAdd (newview);this.selectarray[k++]=newview;Unsaved ();}
if(k==1) {this.select=this.selectarray[0];this.selectarray=null;}
this.ViewListDraw ();page.updateSettings ();}
return false;}
this.onclickContextMenuDelete=function () {Actions_Close ();if(this.select) {viewlist.ViewListDelete (this.select);Unsaved ();}
if(this.selectarray) {for (var i in this.selectarray) {viewlist.ViewListDelete (this.selectarray[i]);}
Unsaved ();}
this.UnSelectAll ();this.ViewListDraw ();return false;}
this.onclickContextMenuSelectAll=function () {Actions_Close ();this.UnSelectAll ();this.selectarray=[];for (var i in this.list) {this.selectarray[i]= this.list[i];}
this.ViewListDraw ();return false;}
this.restoreFromHistory=function (history) {if(history!=null) {this.UnSelectAll ();this.list=[];for (var i in history.list) {this.list[i]= clone (history.list[i]);}}
Unsaved (3);this.ViewListDraw ();}
this.onclickContextMenuUndo=function () {Actions_Close ();this.restoreFromHistory (GetHistoryUndo ());return false;}
this.onclickContextMenuRedo=function () {Actions_Close ();this.restoreFromHistory (GetHistoryRedo ());return false;}
this.getConfiguration=function () {var curview;var controls=new Array ();for (var i in this.list) {curview=this.list[i];controls[controls.length]=curview.getConfiguration ();}
return controls;}
this.setConfiguration=function (controls)  {var curview;if(ProjectVersion<8) {for (var i in controls) {control=controls[i];if(control['name']!=undefined) {if(control['name']=='ControlPanel') {curview=new window[control['name']](0);curview.setConfiguration (control);viewlist.ViewListAdd (curview);}}}}
for (var i in controls) {control=controls[i];if(control['name']!=undefined) {if((ProjectVersion<8)&&(control['name']=='ControlPanel')) continue;if(control['drawtype']!=undefined) curview=new window[control['name']](control['drawtype']);else {try {curview=new window[control['name']](0);} catch (err) {continue;}}
curview.setConfiguration (control);viewlist.ViewListAdd (curview);}}}
this.getPages=function () {var pages=null;for (var i in this.list) {curview=this.list[i];if(curview.classname==CLASSNAME_PAGE) {if(pages==null) pages={0:"- all pages -"};pages[curview.page]=curview.text;}}
return pages;}
this.moveZposition=function (dir) {Actions_Close ();var selectArray=this.getSelectArray ();if(!selectArray) return;var oldList=this.list;this.list=[];var pointer;if(dir==-2) pointer=0;else if(dir==2) pointer=oldList.length-1;else {if(dir==-1) pointer=oldList.length+1;else pointer=-1;for (var i=0; i<oldList.length; i++) {for (var j in selectArray) {if(oldList[i]==selectArray[j]) {if(dir==-1) {var en=false;for (var k=i-1; k>=0; k--) {if(this.visibleView (oldList[k])) {en=true;if(pointer>k) pointer=k;break;}}
if(!en) pointer=0;}
else if(dir==1) {var en=false;for (var k=i+1; k<oldList.length; k++) {if(this.visibleView (oldList[k])) {en=true;if(pointer<k) pointer=k;break;}}
if(!en) pointer=oldList.length-1;}}}}}
if(pointer<0) pointer=0;if(pointer>=oldList.length) pointer=oldList.length-1;for (var i=0; i<oldList.length; i++) {if(dir<0) {if(i==pointer) {for (var j in selectArray) this.list.push(selectArray[j]);}}
var psh=true;for (var j in selectArray) {if(oldList[i]==selectArray[j]) {psh=false;}}
if(psh) this.list.push (oldList[i]);if(dir>0) {if(i==pointer) {for (var j in selectArray) this.list.push(selectArray[j]);}}}
Unsaved ();this.ViewListDraw ();return false;}
this.ViewListClear ();}function Scheme () {this.items ={'connection':'Bluetooth','device':'ArduinoUno','module':'HC-05','ide':'Arduino'};this.generator="";this.activeItemFromChange;this.activeItemsFromChange;this.htmlScheme='';this.pinsMap={};this.getConfiguration=function ()  {return this.items;}
this.setConfiguration=function (configuration)  {updateObject (this.items, configuration);this.pinsMap=this.getPinsMap ();}
this.getHtmlScheme=function ()  {return this.htmlScheme;}
/*
отображает схему на рабочем столе редактора
*/
this.run=function () {var thisScheme=this;var xmlhttp=getXmlHttp();xmlhttp.open('POST', '/en/editor/scheme/?action=scheme', true);xmlhttp.onreadystatechange=function() {if(xmlhttp.readyState==4) {if(xmlhttp.status==200) {var result=parseJSON (xmlhttp.responseText);if(result!=undefined) {thisScheme.htmlScheme=result['html'];updateObject (thisScheme.items, result['scheme']);thisScheme.generator=result['scheme']['generator'];}
page.updateSettings ();}}};xmlhttp.send(serializeJSON (this.items));}
this.openChangeWindow=function (item) {this.activeItemFromChange=item;this.activeItemsFromChange=clone (this.items);Windows_Open ('window_scheme', 28);this.loadChangeWindow ();}
this.updateChangeWindow=function (item, value) {if(item=='') item=this.activeItemFromChange;else this.activeItemFromChange=item;if(value!='') this.activeItemsFromChange[item]=value;this.loadChangeWindow ();}
this.applyChangeWindow=function () {for (var name in this.activeItemsFromChange) {if(this.activeItemsFromChange[name]=='') return;}
updateObject (this.items, this.activeItemsFromChange);PageWillClose ();document.location.href='/en/editor/';}
this.enableApplyButton=function (f)  {var el=document.getElementById('window_scheme_button_apply');if(f) {el.style.background='';el.onclick=onClickApplyScheme;}
else {el.style.background='#E9A62E';el.onclick="return false;";}}
this.loadChangeWindow=function () {var body=document.getElementById('window_scheme_body');this.enableApplyButton (false);var xmlhttp=getXmlHttp();var thisScheme=this;xmlhttp.open('POST', '/en/editor/scheme/?action=change&item='+this.activeItemFromChange, true);xmlhttp.onreadystatechange=function() {if(xmlhttp.readyState==4) {if(xmlhttp.status==200) {body.innerHTML=xmlhttp.responseText;var div=body.children.schemeValues;thisScheme.activeItemsFromChange=parseJSON (div.innerHTML);div.innerHTML='';var itCorrect=true;for (var i in thisScheme.activeItemsFromChange) {if(thisScheme.activeItemsFromChange[i]=='') itCorrect=false;}
if(itCorrect) thisScheme.enableApplyButton (true);}}};xmlhttp.send(serializeJSON (this.activeItemsFromChange));}
this.getPins=function () {var pins=this.pinsMap.pins;var arr={};for (var i in pins) {if(pins[i].digital==1) {arr[i]=pins[i].name;}}
return arr;}
this.getDefaultPin=function () {return this.pinsMap.def;}
this._newPin=function (name, digital, analog) {return {'name':name,'digital':digital,'analog':analog,'softrx':0,'softtx':0};}
this._addPins=function (pins, digital, analog, arr) {for (var i in arr) pins[i]=this._newPin (arr[i],digital,analog);}
this._setRXPins=function (pins, arr) {for (var i in arr) pins[arr[i]].softrx=1;}
this._setRXPinsAll=function (pins) {for (var i in pins) pins[i].softrx=1;}
this._setTXPinsAll=function (pins) {for (var i in pins) pins[i].softtx=1;}
this._getPinsArduino=function (c, a) {var pins={'0':this._newPin ('0(RX)',1,0),'1':this._newPin ('1(TX)',1,0)};for (var i=2; i<c; i++) {var name=''+i;if(i==13) name+='(LED)';pins[''+i]=this._newPin(name,1,0);}
for (var i=0; i<a; i++) {pins['A'+i]=this._newPin('A'+i+'('+(i+c)+')',1,1);}
return pins;}
this.getPinsMap=function () {var device=this.items.device;if(device=='ArduinoMega') {var pins=this._getPinsArduino (54, 16);this._setRXPins (pins, ['10','11','12','13','14','15','50','51','52','53','A8','A9','A10','A11','A12','A13','A14','A15']);this._setTXPinsAll (pins);pins['0'].softtx=0;pins['1'].softtx=0;return {'pins': pins,'def':'13','softrx':'10','softtx':'11','serials': {'Serial':'Serial, pins 0(RX) and 1(TX)','Serial1':'Serial1, pins 19(RX) and 18(TX)','Serial2':'Serial2, pins 17(RX) and 16(TX)','Serial3':'Serial3, pins 15(RX) and 14(TX)'}};}
else if((device=='ArduinoLeonardo')||(device=='ArduinoMicro')) {var pins=this._getPinsArduino (14, 6);this._setRXPins (pins, ['8','9','10','11','A0','A1','A2']);this._setTXPinsAll (pins);return {'pins': pins,'def':'13','softrx':'8','softtx':'9','serials': {'Serial1':'Serial1, pins 0(RX) and 1(TX)'}};}
else if((device=='WeMosD1R2')||(device=='WeMosD1mini')||(device=='NodeMCUv2')||(device=='NodeMCUv3')) {var pins={};for (var i=0; i<9; i++) pins['D'+i]=this._newPin('D'+i,1,0);this._setTXPinsAll (pins);this._setRXPins (pins, ['D1','D2','D3','D4','D5','D6','D8']);pins['A0']=this._newPin('A0',0,1);return {'pins': pins,'def':'D4','softrx':'D1','softtx':'D2','serials': {'Serial':'Serial, pins RX and TX'}};}
else if(device=='WeMosD1') {var pins={};this._addPins (pins,1,0,{'D2':'D2', 'D3':'D3(D15)', 'D4':'D4(D14)', 'D5':'D5(D15)','D6':'D6(D12)', 'D7':'D7(D11)', 'D8':'D8', 'D9':'D9', 'D10':'D10'});this._setTXPinsAll (pins);this._setRXPins (pins, ['D3','D4','D5','D6','D7','D8','D10']);pins['A0']=this._newPin('A0',0,1);return {'pins': pins,'def':'D9','softrx':'D3','softtx':'D4','serials': {'Serial':'Serial, pins D0(RX) and D1(TX)'}};}
else if(device=='ESP32') {var pins={};for (var i=0; i<40; i++) pins[''+i]=this._newPin(''+i,1,0);this._setTXPinsAll (pins);this._setRXPinsAll (pins);pins['3'].name='3(RX)';pins['1'].name='1(TX)';return {'pins': pins,'def':'16','softrx':'16','softtx':'17','serials': {'Serial':'Serial, pins RX(3) and TX(1)'}};}
else if((device=='chipKIT_uC32')||(device=='chipKIT_Uno32')) {pins=this._getPinsArduino (14, 12);for (var i=26; i<=46; i++) pins[''+i]=this._newPin(''+i,1,0);pins['39'].name='39(RX)';pins['40'].name='40(TX)';pins['43'].name='43(LED)';this._setTXPinsAll (pins);this._setRXPins (pins, ['10','11','12','13','34','36','37','39','40','41','42','44','A0','A1','A6','A7']);return {'pins': pins,'def':'13','softrx':'2','softtx':'3','serials': {'Serial':'Serial, pins 0(RX) and 1(TX)','Serial1':'Serial1, pins 39(RX) and 40(TX)'}};}
else if(device=='chipKIT_Max32') {pins=this._getPinsArduino (54, 16);for (var i=70; i<=85; i++) pins[''+i]=this._newPin(''+i,1,0);pins['18'].name='18(RX)';pins['19'].name='19(TX)';pins['16'].name='16(RX)';pins['17'].name='17(TX)';pins['14'].name='14(RX)';pins['15'].name='15(TX)';this._setTXPinsAll (pins);this._setRXPins (pins, ['4','10','16','17','18','19','29','39','43','47','50','51','52','53','A0','A1','A2','A3','A4','A5','A15','75','76','77']);return {'pins': pins,'def':'13','softrx':'2','softtx':'3','serials': {'Serial':'Serial, pins 0(RX) and 1(TX)','Serial1':'Serial1, pins 19(RX) and 18(TX)','Serial2':'Serial2, pins 17(RX) and 16(TX)','Serial3':'Serial3, pins 15(RX) and 14(TX)'}};}
else {pins=this._getPinsArduino (14, 6);this._setRXPinsAll (pins);pins['0'].softrx=0;pins['1'].softrx=0;this._setTXPinsAll (pins);pins['0'].softtx=0;pins['1'].softtx=0;pins[0]
return {'pins': pins,'def':'13','softrx':'2','softtx':'3','serials': {'Serial':'Serial, pins 0(RX) and 1(TX)'}};}}
this.pinsMap=this.getPinsMap ();}function onClickChangeScheme (item) {scheme.openChangeWindow (item);return false;}function onClickItemFromChangeScheme (item) {scheme.updateChangeWindow (item, '');return false;}function onClickElementFromChangeScheme (value) {scheme.updateChangeWindow ('', value);return false;}function onClickApplyScheme () {scheme.applyChangeWindow ();return false;}function getJSONConfiguration () {var jsonStructure={'project': {'name':ProjectName,'version':EditorVersion,'editor': {'nosave':UnsavedProject,'new':NewProject},'page': page.getConfiguration (),'settings': settings.getConfiguration (),'scheme': scheme.getConfiguration (),'controls': viewlist.getConfiguration ()}}
json=serializeJSON (jsonStructure);return json;}function setJSONConfiguration (conf) {var jsonStructure=parseJSON (conf);if(jsonStructure==undefined) return;if(jsonStructure.project==undefined) return;var project=jsonStructure.project;if(project.name!=undefined) ProjectName=project.name;if(project.version!=undefined) ProjectVersion=project.version;if(project.editor!==undefined) {var editor=project.editor;if(editor.nosave!=undefined) UnsavedProject=editor.nosave;if(editor['new']!=undefined) NewProject=editor['new'];}
if(project.page!==undefined) {page.setConfiguration (project.page);}
if(project.settings!==undefined) {settings.setConfiguration (project.settings);}
if(project.scheme!==undefined) {scheme.setConfiguration (project.scheme);}
if(project.controls!==undefined) {viewlist.setConfiguration (project.controls);}}
var ORIENTATION_HORIZONTAL=0;var ORIENTATION_VERTICAL=1;var ORIENTATION_BOTH=2;function Settings () {this.items={'backgroundcolor':5+8,'orientation':ORIENTATION_HORIZONTAL,'password':'','arduino': {'interface':'softwareserial','serial':'Serial','rx':'2','tx':'3','speed':'9600'},'wifipoint': {'ssid':'RemoteXY','open':0,'password':'12345678'},'wifi': {'ssid':'YOUR_SSID','password':'YOUR_PASS'},'ethernet': {'macaddress':'DE:AD:BE:EF:EF:ED','port':'6377'},'cloud': {'setmanually':1,'host':'','port':'6376','token':''},'bluetooth': {'name':'RemoteXY','mode':0}};this.itemsFromChange;this.getViewSettings=function () {var html='';var selectcolor=this.items.backgroundcolor;html+=getHTMLSettingsColor ("Background color","st_backgroundcolor", selectcolor, 1);/*
var html="<div class=\"editor_settings_item\"><p>Color:</p><div>";var k=1, border;var id='st_backgroundcolor_';for (var i in BackgroundColorsInt) {if(i==selectcolor) border="border: 2px #C22EFF solid;"
else border="";html+="<div id=\"bg_color_"+i+"\" class=\"editor_settings_color\" style=\"background-color:"+getStyleColor (BackgroundColorsInt[i])+";"+border+"\" onmousedown=\"onchangeSetting('"+id+i+"');\"></div>";if(k++==8) {html=html+"</div><div>"; k=1;}}
html+="</div></div>";*/
var or={0:"Horizontal",1:"Vertical",2:"Both"};html+=getHTMLSettingsSelect ('Orientation', 'st_orientation', getHTMLSelectOptions (this.items.orientation, or));html+=getHTMLSettingsText ('Access password', 'st_password', this.items.password);return html;}
this.getConfiguration=function ()  {return this.items;}
this.setConfiguration=function (configuration)  {updateObject (this.items, configuration);if(ProjectVersion<8) this.items.backgroundcolor +=8;}
this.getBackgroundColor=function ()  {return this.items.backgroundcolor;}
this.setBackgroundColor=function (color)  {this.items.backgroundcolor=color;}
/*
настройка элемента
*/
this.getHtmlInterfaceSetting=function () {var html='';var module=scheme.getConfiguration().module;var connection=scheme.getConfiguration().connection;if(connection=='Cloud') {if(module=='EPS8266') {html+=this._getHtmlInterfaceSetting_Serial ();html+=this._getHtmlInterfaceSetting_Wifi ();}
else if((module=='ESP8266OnBoard')||(module=='WiFiOnChip')) {html+=this._getHtmlInterfaceSetting_Wifi ();}
else if(module=='W5100SHIELD') {html+=this._getHtmlInterfaceSetting_Ethernet ();}
html+=this._getHtmlInterfaceSetting_Cloud ();}
else {if((module=='HC-05')||(module=='HM-10')||(module=='USB')) {html+=this._getHtmlInterfaceSetting_Serial ();}
else if(module=='EPS8266') {html+=this._getHtmlInterfaceSetting_Serial ();if(connection=='Wifi') html+=this._getHtmlInterfaceSetting_WifiPoint ();else html+=this._getHtmlInterfaceSetting_Wifi ();html+=this._getHtmlInterfaceSetting_ServerPort ();}
else if((module=='ESP8266OnBoard')||(module=='WiFiOnChip')) {if(connection=='Wifi') html+=this._getHtmlInterfaceSetting_WifiPoint ();else html+=this._getHtmlInterfaceSetting_Wifi ();html+=this._getHtmlInterfaceSetting_ServerPort ();}
else if(module=='W5100SHIELD') {html+=this._getHtmlInterfaceSetting_Ethernet ();html+=this._getHtmlInterfaceSetting_ServerPort ();}
else if(module=='BluetoothOnChip') {html+=this._getHtmlInterfaceSetting_Bluetooth ();}}
return html;}
this._getHtmlInterfaceSetting_Serial=function () {var html='';var ss=1;var hs=1;if(scheme.getConfiguration().ide=="MPIDE") ss=0;var items=this.items.arduino;var pinsMap=scheme.pinsMap;var device=scheme.getConfiguration().device;var interfaces={};if(ss==1) interfaces['softwareserial']='Software Serial';if(hs==1) interfaces['hardwareserial']='Hardware Serial';if(interfaces[items.interface]===undefined) items.interface=getFirstPropertyName (interfaces);html+=getHTMLSettingsSelect ('Connection interface', 'st_arduino_interface', getHTMLSelectOptions (items.interface, interfaces));if(items.interface=='softwareserial') {var arx={};var atx={};var pins=pinsMap.pins;for (var i in pins) {if(pins[i].softrx==1) arx[i]=pins[i].name;if(pins[i].softtx==1) atx[i]=pins[i].name;}
if((arx[items.rx]===undefined)||(atx[items.tx]===undefined)) {items.rx=pinsMap.softrx;items.tx=pinsMap.softtx;}
html+=getHTMLSettingsSelect ('RX pin', 'st_arduino_rx', getHTMLSelectOptions (items.rx, arx), '50%');html+=getHTMLSettingsSelect ('TX pin', 'st_arduino_tx', getHTMLSelectOptions (items.tx, atx), '50%');html+=getHTMLSettingsSelect ('Speed (baud rate)', 'st_arduino_speed', getHTMLSelectOptions (items.speed, this.getBaudRatesForSoftSerial ()));}
else if(items.interface=='hardwareserial') {var a=pinsMap.serials;if(a[items.serial]===undefined) items.serial=getFirstPropertyName (a);html+=getHTMLSettingsSelect ('Serial port', 'st_arduino_serial', getHTMLSelectOptions (items.serial, a));html+=getHTMLSettingsSelect ('Speed (baud rate)', 'st_arduino_speed', getHTMLSelectOptions (items.speed, this.getBaudRates ()));}
return html;}
this._getHtmlInterfaceSetting_WifiPoint=function () {var html='';var items=this.items.wifipoint;var pid="st_wifipoint_";html+="<div class=\"editor_settings_group\">Wi-Fi access point:</div>";html+=getHTMLSettingsText ('Name (SSID)', pid+'ssid', items.ssid);html+=getHTMLSettingsCheckbox ('Open point', pid+'open', items.open);if(!items.open)html+=getHTMLSettingsText ('Password (8 or more chars)', pid+'password', items.password);return html;}
this._getHtmlInterfaceSetting_Wifi=function () {var html='';var items=this.items.wifi;var pid="st_wifi_";html+="<div class=\"editor_settings_group\">Wi-Fi connection:</div>";html+=getHTMLSettingsText ('Name (SSID)', pid+'ssid', items.ssid);html+=getHTMLSettingsText ('Password', pid+'password', items.password);return html;}
this._getHtmlInterfaceSetting_Ethernet=function () {var html='';var items=this.items.ethernet;html+=getHTMLSettingsText ('Mac address', 'st_ethernet_macaddress', ''+items.macaddress);return html;}
this._getHtmlInterfaceSetting_ServerPort=function () {return getHTMLSettingsText ('Port', 'st_ethernet_port', ''+this.items.ethernet.port, "50%");;}
this._getHtmlInterfaceSetting_Cloud=function () {var html='';var items=this.items.cloud;var pid="st_cloud_";html+="<div class=\"editor_settings_group\">Cloud server:</div>";var selid=0;var tokens={0:'- Set manually -'};var inf='';if(usertokens) {for (var i in usertokens) {var el=usertokens[i];tokens[el.id]=el.name;if(items.setmanually==0)if((el.token==items.token)&&(el.port==items.port)&&(el.host==items.host)) selid=el.id;}}
var f=(selid==0)?false:true;html+=getHTMLSettingsSelect ('Token', pid+'tokenid', getHTMLSelectOptions (selid, tokens));html+="<div class=\"editor_settings_button\"><a href=\"/en/account/tokens/\">My tokens</a></div>";html+=getHTMLSettingsText ('Server', pid+'host', items.host,0, f);html+=getHTMLSettingsText ('Port', pid+'port', items.port,0, f);html+=getHTMLSettingsText ('Token', pid+'token', items.token,0, f);return html;}
this._getHtmlInterfaceSetting_Bluetooth=function () {var html='';var items=this.items.bluetooth;var device=scheme.getConfiguration().device;var pid="st_bluetooth_";html+=getHTMLSettingsText ('Bluetooth name', pid+'name', items.name);if(device=='ESP32') {var modeList={0:"Bluetooth LE",1:"Classic bluetooth"};html+=getHTMLSettingsSelect ('Mode', pid+'mode', getHTMLSelectOptions (items.mode, modeList), '100%');}
return html;}
this.setErrorForElement= function (el) {el.style.background="#FFC0C0";}
this.onchangeSetting= function (id) {var value;var el=document.getElementById(id);if(id.substr(0,19)=='st_backgroundcolor_') {value=id.substr(19,id.length);this.items.backgroundcolor=parseInt (value);}
else if(id=='st_orientation') {this.items.orientation=parseInt (el.value);viewlist.loadOrientation ();updateEditorPage (1);}
else if(id=='st_password') {if(el.value!='') {if((el.value.indexOf(' ')>=0)||(el.value.length>25)) {this.setErrorForElement (el);return false;}}
this.items.password=el.value;}
else if(id.substr(0,11)=='st_arduino_') {value=el.value;this.items.arduino[id.substr(11)]=value;}
else if(id.substr(0,13)=='st_wifipoint_') {var name=id.substr(13);if(name=="open") value=el.checked?1:0;else value=el.value;if((name=="password")&&(value.length<8)) {this.setErrorForElement (el);return false;}
this.items.wifipoint[name]=value;}
else if(id.substr(0,8)=='st_wifi_') {var name=id.substr(8);this.items.wifi[name]=el.value;}
else if(id.substr(0,12)=='st_ethernet_') {var name=id.substr(12);value=el.value;if(name=="port") {var err=1;var port=parseInt (value);if(!isNaN(port)) {if((port>=0)&&(port<=65535)) {el.value=port;err=0;}}
if(err==1) {this.setErrorForElement (el);return false;}}
else if(name=="macaddress") {var err=0;var ch;if(value.length!=17) err=1;else {for(var i=0; i<17;i++) {ch=value.substr(i,1);if((i+1)%3==0) {if(ch!=':') err=1;}
else if(!(((ch>='0')&&(ch<='9'))||
((ch>='A')&&(ch<='F'))||
((ch>='a')&&(ch<='f'))) ) err=1;}}
if(err==1) {this.setErrorForElement (el);return false;}}
this.items.ethernet[name]=value;}
else if(id.substr(0,9)=='st_cloud_') {var name=id.substr(9);value=el.value;var items=this.items.cloud;if(name=="host") items.host=value;else if(name=="port") {var err=1;var port=parseInt (value);if(!isNaN(port)) {if((port>=0)&&(port<=65535)) {items.port=port;err=0;}}
if(err==1) {this.setErrorForElement (el);return false;}}
else if(name=="token") items.token=value;else if(name=="tokenid") {items.setmanually=1;if((value!=0)&&(usertokens)) {for (var i in usertokens) {var el=usertokens[i];if(el.id==value) {items.host=el.host;items.port=el.port;items.token=el.token;items.setmanually=0;break;}}}}}
else if(id.substr(0,13)=='st_bluetooth_') {var name=id.substr(13);value=el.value;var items=this.items.bluetooth;if(name=="name") items.name=value;if(name=="mode") items.mode=parseInt(value);}
return true;}
this.getBaudRates=function () {return {'2400':'2400','4800':'4800','9600':'9600','19200':'19200','38400':'38400','57600':'57600','115200':'115200'}}
this.getBaudRatesForSoftSerial=function () {return {'2400':'2400','4800':'4800','9600':'9600','19200':'19200'}}}function OnClickSettings () {settings.openSettingsWindow ();return false;}function OnClickApplySettings () {settings.applySettingsWindow  ();return false;}function Page () {this.items={'scheme':0,'interface':0,'view':0,'element':1,'controls':1,'indications':0,'decorations':0,'notifications':0,'selpage':0,'orientation':0};this.textInputIds={};this.nowUpdateSettings=false;this.getViewPage=function () {return this.items.selpage;}
this.setViewPage=function (page) {this.items.selpage=page;}
this.getViewOrientation=function  () {var or=settings.items.orientation;if(or==ORIENTATION_BOTH) {or=this.items.orientation;}
return or;}
this.getConfiguration=function ()  {return this.items;}
this.setConfiguration=function (configuration)  {updateObject (this.items, configuration);}
this.updateControls=function() {var html='';if(controlList) {html+=getHtmlSettingsGroup ('controls','Controls', controlList.getHtmlControls ());html+=getHtmlSettingsGroup ('indications','Indication', controlList.getHtmlIndications ());html+=getHtmlSettingsGroup ('decorations','Decoration', controlList.getHtmlDecorations ());html+=getHtmlSettingsGroup ('notifications','Notifications', controlList.getHtmlEvents ());}
elEditorLeftGroups.innerHTML=html;}
this.updateSettings=function() {if(this.nowUpdateSettings) return;this.nowUpdateSettings=true;this.textInputIds={};var html='';if(scheme) {html+=getHtmlSettingsGroup ('scheme','Configuration', scheme.getHtmlScheme ());}
if(settings) {html+=getHtmlSettingsGroup ('interface','Module interface', settings.getHtmlInterfaceSetting());}
if(viewlist) {html+=getHtmlSettingsGroup ('view','View', settings.getViewSettings ());html+=getHtmlSettingsGroup ('element','Element', viewlist.getHtmlElementSetting ());}
elEditorRightGroups.innerHTML=html;this.nowUpdateSettings=false;}
this.changeSetting=function(id) {var prefix=id.substr(0,3);if(prefix=='el_') {if(viewlist.onchangeSetting (id)) {Unsaved ();return true;}
return false;}
else if(prefix=='st_') {if(settings.onchangeSetting (id)) {Unsaved (3);return true;}
return false;}
return false;}
this.onchangeSetting=function(id) {var itisText=false;for (var curid in this.textInputIds) {if(curid==id) {var el=document.getElementById(curid);if(el) el.style.background="#FFFFFF";itisText=true;}}
if(this.changeSetting (id)) {Actions_Close ();Unsaved ();Draw ();if(!itisText) {page.updateSettings ();}}}}function getHTMLSettingsText (name, id, value, width, disabled) {if(disabled===undefined) disabled=false;if(!width) width='100%';var _value;if(typeof value=='string')_value=value.replace(new RegExp("\"","g"), '&quot;');else _value=value;page.textInputIds[id]=value;sname='';if(name!='') sname='<p>'+name+':</p>';return '<div class="editor_settings_item" style="width: '+width+';">'+sname+'<input type="text" id="'+id+'" class="editor_settings_input" value="'+_value+'" autocomplete="off" onchange="return onchangeSetting (\''+id+'\');"'+(disabled?' disabled':'')+'></div>';}function getHTMLSettingsSelect (name, id, selectOptions, width) {if(!width) width='100%';return '<div class="editor_settings_item" style="width: '+width+';"><p>'+name+':</p><select id="'+id+'" class="editor_settings_input" onchange="return onchangeSetting (\''+id+'\');">'+selectOptions+'</select></div>';}function getHTMLSettingsCheckbox (name, id, value, width) {if(!width) width='100%';return '<div class="editor_settings_item" style="width: '+width+';"><input type="checkbox" id="'+id+'" class="editor_settings_checkbox" '+(value?'checked':'')+' onchange="return onchangeSetting (\''+id+'\');"> '+name+'</div>';}function getHTMLSettingsColor (name, id, colorID) {var color=getColorByID (colorID);var q="";if(colorID<0) q="?";var html="<div class=\"editor_settings_item\">";if(name!="") html+="<p>"+name+":</p>";html+="<div onclick=\"OnClickContextColor(event,'"+id+"', "+colorID+");\">";html+="<div class=\"editor_settings_color\" style=\"background-color:"+getStyleColor(color)+";\">"+q+"</div>";html+="<div class=\"editor_settings_a\" style=\"padding: 4px 0 0 10px;\">Change...</div>";html+="</div></div>";return html;}function onchangeSetting (id) {if(page.onchangeSetting (id)) {Windows_CloseContextMenu (elContextMenu);Unsaved ();Draw ();page.updateSettings ();}
return false;}function getHtmlSettingsGroup (id, name, context) {if(context=='') return '';var html='';var display, img;if(page.items[id]==0) { display='none'; img='right';}
else {display='block'; img='down';}
html+='<div class="editor_col_group_name" onclick="onclickToolsGroup(\''+id+'\');"><img id="img_'+id+'" src="/img/editor/'+img+'.png">'+name+'</div>';html+='<div class="editor_col_group_body" id="tools_'+id+'" style="display:'+display+';"><div class="editor_col_group_cont">';html+=context;html+='</div></div>';return html;}function onclickToolsGroup (id) {var el=document.getElementById('tools_'+id);var img=document.getElementById('img_'+id);if(el) {if(el.style.display=='block') {el.style.display='none';if(img) img.src='/img/editor/right.png';page.items[id]=0;}
else {el.style.display='block';if(img) img.src='/img/editor/down.png';page.items[id]=1;}}}function OnClickOrientation (or) {if((or>=0)&&(or<=1))page.items.orientation=or;viewlist.loadOrientation ();updateEditorPage (1);}function OnClickContextColor (event, id, colorID) {var e=event||window.event;var html="<div style=\"background-color:#f8f8f8\">";var border, c, color;html+="<div>";for (var i=0; i<32; i++) {if(i<8) c=i+16;else if(i<24) c=i-8;else c=i;if(c==colorID) border="border: 2px #C22EFF solid;";else border='';color=getColorByID (c);if((i%8==0)&&(i!=0)) html+="</div><div>";html+="<div class=\"editor_context_color\" style=\"background-color:"+getStyleColor(color)+";"+border+"\" onmousedown=\"onchangeSetting('"+id+"_"+c+"');\"></div>";}
html+="</div>";html+="<div>";for (var i=0; i<256-32; i++) {c=i+32;if(c==colorID) border="border: 2px #C22EFF solid;";else border='';color=getColorByID (c);if((i%14==0)&&(i!=0)) html+="</div><div>";html+="<div class=\"editor_context_color\" style=\"background-color:"+getStyleColor(color)+";"+border+"\" onmousedown=\"onchangeSetting('"+id+"_"+c+"');\"></div>";}
html+="</div>";html+="</div>";elContextMenu.innerHTML=html;var x=e.pageX;var y=e.pageY;if(x+310 > elContent.clientWidth) x=elContent.clientWidth-310;if(y+460 > elContent.clientHeight) y=elContent.clientHeight-460;Actions_Open ("div_contextmenu", x, y, 0);}
var control_canvas;var control_context;var control_view;var control_dragdrop=0;function ControlList () {this.list=[
new ControlButton (0),new ControlSwitch (0),new ControlSelect (0),new ControlSlider (0),new ControlJoystick (0),new ControlRGB (0),new ControlEdit (0),new ControlDiode (0),new ControlLevel (1),new ControlLevel (2),new ControlLevel (3),new ControlLevel (4),new ControlText (0),new ControlOnlineGraph (0),new ControlSound (0),new ControlLabel (0),new ControlPanel (1),new ControlPage (1),];this.getHtmlControls=function ()  {return this._getHtml (GROUP_CONTROLS);}
this.getHtmlIndications=function ()  {return this._getHtml (GROUP_INDICATIONS);}
this.getHtmlEvents=function ()  {return this._getHtml (GROUP_NOTIFICATIONS);}
this.getHtmlDecorations=function ()  {return this._getHtml (GROUP_DECORATIONS);}
this._getHtml=function (group)  {var html='', el;for (var i in this.list) {el=this.list[i];if(el.group==group) {html+='<div class="editor_controls_item" onmousedown="return onmousedownControl ('+i+', event);" ontouchstart="return onmousedownControl ('+i+', event);" ondrag="return false;"><img src="'+el.img+'"><p>'+el.name+'</p></div>';}}
return html;}
control_canvas=document.createElement("canvas");control_canvas.style.position="absolute";control_canvas.style.display="none";control_context=control_canvas.getContext('2d');document.body.appendChild(control_canvas);control_dragdrop=0;}function onmousedownControl (i, event) {var e=event||window.event;var x, y;if(e.type=="mousedown") {if((e.which==2)||(e.which==3)) return false;x=e.pageX;y=e.pageY;}
else if(e.type=="touchstart") {var touch=event.targetTouches[0];x=touchx=touch.pageX;y=touchy=touch.pageY;}
else return false;if(isTablet ()) Windows_Close ('editor_leftcol');var control=controlList.list[i];control.top=MARKER_SIZE/contextStep;control.left=MARKER_SIZE/contextStep;control_canvas.width=control.width*contextStep+MARKER_SIZE*2 ;control_canvas.height=control.height*contextStep+MARKER_SIZE*2;control_canvas.style.left=(x-control_canvas.width/2) +'px';control_canvas.style.top=(y-control_canvas.height/2) +'px';control_context.fillStyle="#FFFFFF";control_context.fillRect(0, 0, control_canvas.width, control_canvas.height);control_context.strokeStyle="#000000";control_context.strokeRect(0, 0, control_canvas.width, control_canvas.height);control.ControlDraw (control_context);control_canvas.style.display="block";control_dragdrop=1;control_view=control;return false;}function onmousemoveControl (event) {var e=event||window.event;if(e.type=="mousemove") {x=e.pageX;y=e.pageY;}
else if(e.type=="touchmove") {var touch=event.targetTouches[0];x=touchx=touch.pageX;y=touchy=touch.pageY;}
else return true;if(control_dragdrop) {control_canvas.style.left=(x-control_canvas.width/2) +'px';control_canvas.style.top=(y-control_canvas.height/2) +'px';return false;}
return true;}function onmouseupControl (event) {var e=event||window.event;if(control_dragdrop) {var x, y;if(e.type=="mouseup") {x=e.pageX;y=e.pageY;}
else if(e.type=="touchend") {x=touchx;y=touchy;}
else return true;control_dragdrop=0;control_canvas.style.display="none";canvpos=getElementPosition (canv);cx=x-canvpos.left;cy=y-canvpos.top;if((cx>=0)&&(cy>=0)&&(cx < contextWidth)&&(cy < contextHeight)) {v=new window[control_view.classname](control_view.drawtype);v.left=Math.round ((cx-v.width*contextStep/2)/contextStep);v.top= Math.round ((cy-v.height*contextStep/2)/contextStep);v.createNew ();viewlist.ViewListAdd (v);Unsaved ();}
return false;}
return true;}